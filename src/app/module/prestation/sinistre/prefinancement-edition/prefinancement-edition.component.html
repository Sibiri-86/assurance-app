<div class="p-grid">
	<div class="p-col-12">
		<p-toast></p-toast>
		<div class="card">
			<p-toolbar styleClass="p-mb-4">
				<ng-template pTemplate="left">
					<button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success p-mr-2 p-mb-2" (click)="addPrefinancement()"></button>
					<button pButton pRipple label="Supprimer" [disabled]="selectedPrefinancement?.length<1" icon="pi pi-trash" class="p-button-danger p-mb-2" (click)="supprimerPrefinancement()"></button>
				</ng-template>
                <ng-template pTemplate="right">
					<button pButton pRipple label="Aller aux sinistres validés" icon="pi pi-arrow-right" class="p-button-secondary p-mr-2 p-mb-2" (click)="navigateSinistre()"></button>
				</ng-template>
                
			</p-toolbar>
            <div class="p-formgroup-inline">
                <div class="p-field">
                    <label for="matricule" class="p-sr-only"></label>
                    <p-calendar style="min-width:300px" [showIcon]="true" inputId="icon" dateFormat="dd/mm/yy" [(ngModel)]="dateDebut" placeholder="date debut"></p-calendar>
<!--                     <input style="min-width:300px" id="numero" type="text" pInputText placeholder="numero" [(ngModel)]="numero">
 -->                </div>
                
                <div class="p-field">
                    <label for="dateSoins" class="p-sr-only"></label>
                    <p-calendar [showIcon]="true" inputId="icon" dateFormat="dd/mm/yy" [(ngModel)]="dateFin" placeholder="date fin"></p-calendar>
                </div>
                <div class="p-field">
                    <button pButton pRipple type="button" (click)="rechercherPrefinancementByPeriode()" label="Rechercher"></button>
                </div>
                <div class="p-field">
                    
                </div>
                <div class="p-field" *ngIf="saisie != null">
                    <span style="color: green; font-size: 20px; font-weight: bold;">
                        <mark> Saisie: {{saisie?.nombreSaisie}} </mark>
                    </span>
                </div>
                <div class="p-field" *ngIf="saisie != null">
                    <span style="color: orange; font-size: 20px; font-weight: bold;">
                        <mark>Modifié: {{saisie?.nombreModifie}} </mark>
                    </span>
                </div>
                <div class="p-field" *ngIf="saisie != null">
                    <span style="color: red; font-size: 20px; font-weight: bold;">
                        <mark>Supprimé: {{saisie?.nombreSupprime}} </mark>
                    </span>
                </div>

                <!-- <div *ngIf="saisie != null" class="p-grid p-field">
                    <div class="p-col-3">
                        <span style="color: green; font-size: 20px; font-weight: bold;">
                            Saisie: {{saisie?.nombreSaisie}}
                        </span>
                    </div>
                    <div class="p-col-4">
                        <span style="color: orange; font-size: 20px; font-weight: bold;">
                            Modifié: {{saisie?.nombreModifie}}
                        </span>
                    </div>
                    <div class="p-col-5">
                        <span style="color: red; font-size: 20px; font-weight: bold;">
                            Supprimé: {{saisie?.nombreSupprime}}
                        </span>
                    </div>
                </div> -->
                
            </div> 
            
            
            <p-table #dt [value]="prefinancementDtoList" [autoLayout]="true" [columns]="cols" [rows]="10" [paginator]="true" [globalFilterFields]="['garant.nom','intermediaire.nom','numero','taux.taux']"
                     [rowHover]="true" dataKey="id"
                     styleClass="p-datatable-customers"
                     currentPageReportTemplate="affichage {first} à {last} de {totalRecords} enregistrement" [showCurrentPageReport]="true" [(selection)]="selectedPrefinancement">
                <ng-template pTemplate="caption">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                        <h5 class="p-m-0"></h5>
                        <span class="p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." />
                        </span>
                        <!-- <span class="p-input-icon-right">
                            <div *ngIf="saisie != null" class="p-grid">
                                <div class="p-col-4">
                                    <span>
                                        Saisie: <br> {{saisie?.nombreSaisie}}
                                    </span>
                                </div>
                                <div class="p-col-4">
                                    <span>
                                        Modifié: <br> {{saisie?.nombreModifie}}
                                    </span>
                                </div>
                                <div class="p-col-4">
                                    <span>
                                        Supprimé: <br> {{saisie?.nombreSupprimer}}
                                    </span>
                                </div>
                            </div>
                        </span> -->
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="numero" style="min-width:200px">Numero sinistre<p-sortIcon field="numero"></p-sortIcon></th>
                        <th pSortableColumn="nom" style="min-width:200px">Date declaration<p-sortIcon field="nom"></p-sortIcon></th>
                        <th pSortableColumn="duree" style="min-width:100px">Matricule assuré<p-sortIcon field="duree"></p-sortIcon></th>
                        <th pSortableColumn="dateEffet" style="min-width:200px">Nom <p-sortIcon field="dateEffet"></p-sortIcon></th>
                        <th pSortableColumn="dateEcheance" style="min-width:200px">Prenom<p-sortIcon field="prenom"></p-sortIcon></th>
                        <th pSortableColumn="dateEcheance" style="min-width:100px">Type de paiement<p-sortIcon field="prenom"></p-sortIcon></th>
                        <th pSortableColumn="dateEcheance" style="min-width:100px">Etat<p-sortIcon field="etat"></p-sortIcon></th>
                        <th style="min-width:150px"></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-prefinancement>
                    <tr>
                        <td>
                            <p-tableCheckbox [value]="prefinancement"></p-tableCheckbox>
                        </td>
                        <td><span class="p-column-title" style="min-width:200px">{{prefinancement.numeroSinistre}}</span>
                        </td>
                        <td><span class="p-column-title" style="min-width:200px">{{prefinancement.dateDeclaration | formatTableValue : 'date'}}</span>
                        </td>
                        <td>
                            <span class="p-column-title" style="min-width:100px">{{prefinancement.adherent.numero}}</span>
                        </td>
                        <td>
                            <span class="p-column-title" style="min-width:200px">{{prefinancement.adherent.nom}}</span>
                        </td>
                        <td>
                            <span class="p-column-title" style="min-width:200px">{{prefinancement.adherent.prenom}}</span>
                        </td>

                        <td>
                            <span class="p-column-title" style="min-width:200px">{{prefinancement.typePaiement}}</span>
                        </td>
                        <td>
                            <span *ngIf="prefinancement?.etat ==='VALIDE'" class="p-badge p-badge-success">{{prefinancement?.etat}}</span>
                            <span *ngIf="prefinancement?.etat ==='ENCOURS'" class="p-badge p-badge-warning">EN ATTENTE..</span>
                            <span *ngIf="prefinancement?.etat ==='DEVALIDE'" class="p-badge p-badge-danger">{{prefinancement?.etat}}</span>
                        </td>
                        <td style="min-width:150px">
                            <button pButton pRipple icon="pi pi-pencil" pTooltip="editer" class="p-button-rounded p-button-success p-mr-2" (click)="editerPrestation(prefinancement)"></button>
                            <button pButton  pRipple icon="pi pi-search" pTooltip="voir prestation" class="p-button-rounded p-button-help p-mr-2" (click)="voirPrestation(prefinancement)"></button> 
                            <button pButton icon="pi pi-check" pTooltip="Valider" class="p-button-rounded p-button-info p-mr-2" (click)="validerPrestation(prefinancement)"></button>
                            <button pButton pRipple icon="pi pi-print" pTooltip="Imprimer" class="p-button-rounded p-button-info" (click)="imprimer(prefinancement)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="summary">
                    <div class="p-d-flex p-ai-center p-jc-between">
                        {{prefinancementDtoList ? prefinancementDtoList.length : 0 }} sinistre(s).
                    </div>
                </ng-template>
            </p-table>
        </div> 
        
        
        <p-dialog [maximizable]="true" [(visible)]="displayPrestation" header="Prestation" [modal]="true" styleClass="p-fluid" [style]="{width: '1500px'}"> 
            <ng-template pTemplate="content">
                <div class="card">
                    <p-table #dt [value]="prestationListPrefinancementFilter" [columns]="cols" [rows]="10" [paginator]="true"
                     [rowHover]="true" dataKey="id"
                     styleClass="p-datatable-customers"
                     currentPageReportTemplate="affichage {first} à {last} de {totalRecords} enregistrement" [showCurrentPageReport]="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="numero" style="width: 150px">Date soins<p-sortIcon field="dateSoins"></p-sortIcon></th>
                        <th pSortableColumn="numero" style="width: 150px">SousActe<p-sortIcon field="numero"></p-sortIcon></th>
                        <th pSortableColumn="numero" style="width: 150px">Nombre acte<p-sortIcon field="numero"></p-sortIcon></th>
                        <th pSortableColumn="nom" style="width: 150px">Cout unitaire<p-sortIcon field="nom"></p-sortIcon></th>
                        <th pSortableColumn="taux" style="width: 150px">Débours<p-sortIcon field="taux.taux"></p-sortIcon></th>
                        <th pSortableColumn="territorialite" style="width: 150px">Base de remboursement<p-sortIcon field="territorialite.libelle"></p-sortIcon></th>
                        <th pSortableColumn="territorialite" style="width: 150px">Taux<p-sortIcon field="territorialite.libelle"></p-sortIcon></th>
                        <th pSortableColumn="duree" style="width: 150px">montant remboursé <p-sortIcon field="duree"></p-sortIcon></th>
                        <th pSortableColumn="duree" style="width: 150px">Decision<p-sortIcon field="decision"></p-sortIcon></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-prestation>
                    <tr>
                        <td>
                            <p-tableCheckbox [value]="prestation"></p-tableCheckbox>
                        </td>
                        <td><span class="p-column-title">{{prestation.dateSoins | formatTableValue : 'date'}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.sousActe.libelle}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.nombreActe}}</span>
                        </td>
                        
                        <td><span class="p-column-title">{{prestation.coutUnitaire| formatTableValue: 'number':true}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.debours| formatTableValue: 'number':true}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.baseRemboursement| formatTableValue: 'number':true}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.taux.taux}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.montantRembourse| formatTableValue: 'number':true}}</span>
                        </td>
                        <td><span class="p-column-title">{{prestation.sort}}</span>
                        </td>
                        <td style="min-width:150px">
                            <button pButton pRipple icon="pi pi-trash" pTooltip="supprimer" class="p-button-rounded p-button-warning p-mr-2" (click)="supprimerPrestation(prestation)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="summary">
                    <div class="p-d-flex p-ai-center p-jc-between">
                        {{prestationListPrefinancement ? prestationListPrefinancement.length : 0 }} prestation(s).
                    </div>
                </ng-template>
            </p-table>   
                </div>
            </ng-template>
        </p-dialog>
        <p-dialog [(visible)]="displayPrestationbon"  header="Veuillez attacher une entente préalable"  [modal]="true" styleClass="p-fluid">

            <ng-template pTemplate="content">
                <div class="card">
                <form>
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col-12">
                            <label for="dateSoins">Date de soins <span style="color: red !important; size: 1.4em;" class="required">*</span></label>
                            <input id="dateSoins"   type="date" name="dateSoins" pInputText [(ngModel)]="prestationBon.dateSoins"  (change)="verifieDateSoinsBon($event)" >
                        </div>
                        <div class="p-field p-col-12">
                            <label for="matriculeAdherent">Matricule adhérent <span style="color: red !important; size: 1.4em;" class="required">*</span></label>
                            <input id="matriculeAdherent" [disabled]="!prestationBon.dateSoins" type="text"  [(ngModel)]="prestationBon.matriculeAdherent" name="matriculeAdherent"  (blur)="rechercherAdherentBon($event)" pInputText>
                        </div>
                        <div class="p-field p-col-12">
                            <label for="bonPriseEnCharge">Bon de prise en charge<span style="color: red !important; size: 1.4em;" class="required"></span></label>
                            <p-dropdown inputId="bonPriseEnCharge" dataKey="id" [filter]="true"
                                        showClear="true" [options]="bonPriseEnChargeList"  [disabled]="!prestationBon.matriculeAdherent"
                                        [(ngModel)]="prestationBon.bonPriseEnCharge"
                                          name="bonPriseEnCharge"
                                        optionLabel="numeros">
                                    </p-dropdown>
                        </div>
                    </div>
                </form>
                <div class="p-grid p-justify-between">
                    <div>
                    </div>
                    <div>
                        <button pButton  [disabled]="!prestationBon.bonPriseEnCharge"
                        pRipple icon="pi pi-plus" pTooltip="Ajouter bon" label="Ajouter"
                        class="p-button-success" type="button" (click)="saveBon()"></button>
                    </div>
                </div>
                
                </div>
        
        
                 
                
             </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="displayAssure"  header="Veuillez rechercher un assuré" [modal]="true" styleClass="p-fluid">
            <ng-template pTemplate="content"> 
                <div class="card">
                    <p-toolbar styleClass="p-mb-4">
                        <ng-template pTemplate="left">
                            <div >
                                <label for="lastname2" style="font-weight: bold;">Souscripteur<span style="color: red !important; size: 1.4em;" class="required"></span></label><br>
                                <p-dropdown inputId="souscripteur" dataKey="id" [filter]="true"
                                    showClear="true" [options]="policeList"
                                    [autoDisplayFirst]="false" 
                                    placeholder="Selectionnez le souscripteur"
                                    optionLabel="nom" class="p-mr-2" [(ngModel)]="police"></p-dropdown>
                            
                                <!--  <input id="nom" style="width: 90%;" type="text"  [(ngModel)]="adherentsearch.nom" name="nom" pInputText>  -->                                               
                            </div>
                               
        
                            <div >
                                <label  for="lastname2" style="font-weight: bold;margin-left: 3px;">Matricule garant</label><br>
                                <input   id="matriculeGarant" style="width: 80%;margin-left: 3px;" type="text" Label="Matricule garant" [(ngModel)]="adherentsearch.matriculeGarant" name="matriculeGarant" pInputText>                                                
                                <button pButton icon="pi pi-search" [disabled]="!police && !adherentsearch?.matriculeGarant" class="p-ml-2" (click)="filtrer()"></button>   
                            </div>

                        </ng-template>

                        <ng-template pTemplate="right">
                            <div >
                              <button pButton icon="pi pi-plus" label="Valider" [disabled]="!adherentsSelected?.id" class="p-ml-2" (click)="addAssure()"></button>   
                        </div>
                           

                    </ng-template>
                    </p-toolbar>

                    <div class="p-col-12">
                        <p-table #adt [value]="adherentsList" [(selection)]="adherentsSelected"  [rows]="10" dataKey="id" editMode="row" [paginator]="true"
                        [rowHover]="true" styleClass="p-datatable-customers"
                        [globalFilterFields]="['groupe.police.nom','nom','prenom']"
                         currentPageReportTemplate="affichage {first} à {last} de {totalRecords} enregistrement"
                        [showCurrentPageReport]="true">
                        <ng-template pTemplate="caption">
                            <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                                <h5 class="p-m-0"></h5>
                                <span class="p-input-icon-left">
                                <i class="pi pi-search"></i>
                                <input pInputText type="text" (input)="adt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." />
                                </span>
                            </div>
                        </ng-template>
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 3rem">
                                    </th>
                                    <th>SOUSCRIPTEUR</th>
                                    <th>NOM</th>
                                    <th>PRENOM(S)</th>
                                    <th>DATE NAISS.</th>
                                   
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-historiqueAveantAdherant let-editing="editing"
                                         let-ri="rowIndex">
                                <tr  [ngClass]="{'colorZone': !historiqueAveantAdherant.adherentPrincipal}">
                                    <td style="width: 3rem">
                                        <p-tableRadioButton [value]="historiqueAveantAdherant"></p-tableRadioButton>
                                    </td>
                                    <td>{{historiqueAveantAdherant?.groupe?.police?.nom}}</td>
                                    <td>{{historiqueAveantAdherant?.nom | upercase}}
                                    </td>
                                    <td>{{historiqueAveantAdherant?.prenom }}
                                    </td>
                                    <td>{{historiqueAveantAdherant?.dateNaissance | formatTableValue : 'date'}}
                                    </td>
                                    
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
            </ng-template>
        </p-dialog>
    
        <p-dialog [(visible)]="displayPrestationpop"  header="Veuillez ajouter une prestation" [modal]="true" styleClass="p-fluid" (onHide)="fermerPrestation()">
    
            <ng-template pTemplate="content"> 
                <div class="card">

                    <form (ngSubmit)="addPrestation1()"  [formGroup]="prestationPopForm">
                        
                        
                        <div class="p-fluid p-formgrid p-grid">
                            <div class="p-field p-col">
                                <label for="dateSoins">Date de soins <span class="required">*</span></label>
                                <input type="date" name="dateSoins" id="dateSoins" pInputText formControlName="dateSoins" (change)="verifieDateSoins($event)" (blur)="rechercheAdherentDateSoin($event)">
                            </div>
                            <div class="p-field p-col">
                                <label for="matriculeAdherent">Matricule bénéficiaire <span class="required">*</span></label>
                                <input id="matriculeAdherent" style="width: 80%;" type="text" formControlName="matriculeAdherent" (blur)="rechercherAdherent($event)" pInputText>
                                <button pButton pRipple [disabled]="!prestationPopForm?.value?.dateSoins" icon="pi pi-plus" pTooltip="Recherche un assuré" 
                                class="p-button-success p-ml-1" type="button" (click)="rechercherAssure()"></button>
                            </div>
                            
                            <div class="p-field p-col">
                                <label for="nomAdherent">Nom & Prénom(s) bénéficiare <span class="required">*</span></label>
                                <input *ngIf="adherentSelected?.signeAdherent !=='-'" id="nomAdherent" class="champVert" type="text" formControlName="nomAdherent" pInputText>
                                <input *ngIf="adherentSelected?.signeAdherent ==='-'" id="nomAdherent" class="champRouge" type="text" formControlName="nomAdherent" pInputText>
                            </div>
                           
                            
                           
                            
                        </div>


                        <div class="p-fluid p-formgrid p-grid">
                            <div class="p-field p-col">
                                <label for="nomAdherent">Nom & Prénom(s) adhérent(e)<span class="required">*</span></label>
                                <input *ngIf="adherentSelected?.signeAdherent !=='-'" id="prenomAdherent" class="champVert" type="text" formControlName="prenomAdherent" pInputText>
                                <input *ngIf="adherentSelected?.signeAdherent ==='-'" id="prenomAdherent" class="champRouge" type="text" formControlName="prenomAdherent" pInputText>
                            </div>
                            
                            <div class="p-field p-col">
                                <label for="groupeAdherent">Numero groupe<span class="required">*</span></label>
                                <input *ngIf="adherentSelected?.signeAdherent ==='-'" id="groupeAdherent" class="champRouge" type="text" formControlName="numeroGroupe" pInputText>
                                <input *ngIf="adherentSelected?.signeAdherent !=='-'" id="groupeAdherent" class="champVert" type="text" formControlName="numeroGroupe" pInputText>
                            </div>
                            <div class="p-field p-col">
                                <label for="groupeAdherent">Nom groupe</label>
                                    <input *ngIf="adherentSelected?.signeAdherent ==='-'" id="nomGroupeAdherent" class="champRouge" type="text" formControlName="nomGroupeAdherent" pInputText>
                                    <input *ngIf="adherentSelected?.signeAdherent !=='-'" id="nomGroupeAdherent" class="champVert" type="text" formControlName="nomGroupeAdherent" pInputText>
                            </div>
                            
                           </div>
                           <div class="p-fluid p-formgrid p-grid">
                            <div class="p-field p-col">
                                <label for="policeAdherent">Numero police <span class="required">*</span></label>
                                <input *ngIf="adherentSelected?.signeAdherent !=='-'" id="policeAdherent" class="champVert" type="text" formControlName="numeroPolice" pInputText>
                                <input *ngIf="adherentSelected?.signeAdherent ==='-'" id="policeAdherent" class="champRouge" type="text" formControlName="numeroPolice" pInputText>
                            </div>
    
    
                            <div class="p-field p-col-4">
                                <label for="souscripteur">Souscripteur <span class="required">*</span></label>
                                <input *ngIf="adherentSelected?.signeAdherent !=='-'" id="souscripteur" class="champVert" type="text" formControlName="souscripteur" pInputText>
                                <input *ngIf="adherentSelected?.signeAdherent ==='-'" id="souscripteur" class="champRouge" type="text" formControlName="souscripteur" pInputText>
                            </div>
    
                            <div *ngIf="adherentSelected?.signeAdherent ==='-'" class="p-field p-col" style="margin-top: 7px;">
                                <label for="dateEffet">Date de retrait </label>
                                <p-calendar id="dateSaisie" [inputStyle] = "{'color':'red', 'font-weight':'bold'}" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" formControlName="dateRetrait" appendTo="body"></p-calendar>
                            </div>
                            
                            <!-- <div class="p-field p-col" style="margin-top: 7px;">
                                <label for="medecin">Entente préalable </label>
                                <p-dropdown inputId="bonPriseEnCharge" dataKey="id" [filter]="true"
                                            showClear="true" [options]="bonPriseEnChargeList"
                                            formControlName="bonPriseEnCharge"  [autoDisplayFirst]="false"
                                            optionLabel="numeros" (onChange)="onRowSelectBon($event)"></p-dropdown>
                            </div> -->
                            <div class="p-field p-col">
                                <label for="lastname2">Famille acte <span class="required">*</span></label>
                                <p-dropdown dataKey="id" inputId="garantie" [autoDisplayFirst]="false" [filter]="true" showClear="true" [options]="listFamilleActe" 
                                formControlName="familleActe" optionLabel="garantie.libelle" (onChange)="changeGarantie($event)"></p-dropdown>
                            </div>

                           </div>

                           
                            <div class="p-fluid p-formgrid p-grid">
                                
                               
                                
                                <div class="p-field p-col">
                                    <label for="lastname2">Acte <span class="required">*</span></label>
                                    <p-dropdown dataKey="id" inputId="acte"  [autoDisplayFirst]="false" [filter]="true" showClear="true" [options]="listActe" 
                                    formControlName="acte" optionLabel="acte.libelle" (onChange)="selectActe($event);findMontantPlafond($event)"></p-dropdown>
                                </div>  
                                
                                <div class="p-field p-col">
                                    <label for="sousActe">SousActe <span class="required">*</span></label>
                                    <p-dropdown  [filter]="true"
                                                showClear="true" [options]="listSousActe"
                                                formControlName="sousActe"  [autoDisplayFirst]="false"
                                                optionLabel="sousActe.libelle" (onChange)="selectDateSoinsSousActe(); findMontantConsomme($event); findTaux()"></p-dropdown>      
                                </div>

                                <div class="p-field p-col">
                                    <label for="sousActe">Pathologie<span class="required">*</span></label>
                                    <p-dropdown inputId="pathologie" dataKey="id" [filter]="true"
                                                showClear="true" [options]="pathologieList"
                                                formControlName="pathologie"  [autoDisplayFirst]="false"
                                                optionLabel="code"></p-dropdown>        
                                </div>
                            </div>
                                
                            <div class="p-fluid p-formgrid p-grid">
                                
                                   
                                
                                    <div class="p-field p-col">
                                        <label for="produit">Produit pharmaceutique <span class="required" *ngIf="prestationPopForm?.value?.familleActe?.code === 'FP'">*</span>
                                            <span class="required" *ngIf="prestationPopForm?.value?.familleActe?.code !== 'FP'"></span></label>
                                        <p-multiSelect inputId="produitPharmaceutique" dataKey="id" [filter]="true"
                                                    showClear="true" [options]="produitPharmaceutiqueList"
                                                    formControlName="produitPharmaceutique"  [autoDisplayFirst]="false" (onChange)="changeDisplay()"
                                                    optionLabel="libelle"></p-multiSelect> 
                                                   
                                    </div>

                                    <div *ngIf="prestationPopForm?.value?.familleActe?.code === 'FP'" class="p-field p-col">
                                        <label for="produit">Produit(s) Non Pris en charge</label>
                                        <button [disabled]="!produitPharmaceutiqueSelected" pButton pRipple label="Non Pris en charge" type="button"
                                        (click)="addProduitExclu('right')" icon="pi pi-list" class="p-button-secondary"></button>
                                                   
                                    </div>

                                    <!-- <div *ngIf="prestationPopForm?.value?.familleActe?.code === 'FP'" class="p-field p-col">
                                        <label for="produit">Produit(s) à exclure <span class="required" >*</span>
                                            <span class="required" *ngIf="prestationPopForm?.value?.familleActe?.code !== 'FP'"></span></label>
                                        <p-multiSelect inputId="produitPharmaceutique" dataKey="id" [filter]="true"
                                                    showClear="true" [options]="produitPharmaceutiqueListExclu"
                                                    formControlName="produitPharmaceutiqueExclu"  [autoDisplayFirst]="false"
                                                    optionLabel="libelle"></p-multiSelect> 
                                                   
                                    </div> -->
                                
                                    <div class="p-field p-col">
                                        <label for="medecin">Centre prescripteur<span class="required">*</span></label>
                                        <p-dropdown inputId="prestataire" dataKey="id" [filter]="true"
                                                    showClear="true" [options]="prestatairePrescripteur"
                                                    formControlName="prestataire"  [autoDisplayFirst]="false"
                                                    optionLabel="libelle"></p-dropdown>
                                    </div>
                                
                                    <div class="p-field p-col">
                                        <label for="medecin">Medecin<span class="required">*</span></label>
                                        <p-dropdown inputId="medecin" dataKey="id" [filter]="true"
                                                    showClear="true" [options]="medecinList"
                                                    formControlName="medecin"  [autoDisplayFirst]="false"
                                                    optionLabel="nom">
                                                    <ng-template let-medecin pTemplate="item">
                                                            <span>{{medecin.nom}}  </span>
                                                            <span>{{medecin.prenom}}</span>
                                                    </ng-template>
                                        </p-dropdown>
                                    </div>
                               </div>
                               
                               <div class="p-fluid p-formgrid p-grid">
                                   
                            
                                   
                                

                                <div class="p-field p-col">
                                    <label for="nombreActe">Nombre Acte <span class="required">*</span></label>
                                    <p-inputNumber  [inputStyle]="{'font-weight': 'bold'}" formControlName="nombreActe" mode="decimal" (onBlur)="verificationTaux()" locale="fr-FR"></p-inputNumber>  
                                </div>
                                   
                                <div class="p-field p-col">
                                    <label for="nombreActe">Cout unitaire <span class="required">*</span></label>
                                    <p-inputNumber [inputStyle]="{'font-weight': 'bold'}" formControlName="coutUnitaire" mode="decimal" locale="fr-FR" (onBlur)="calculDebours1()"></p-inputNumber>  
                                </div>
                                <div class="p-field p-col">
                                    <label for="coutUnitaire" id="coutUnitaire">Montant exclu </label>
                                    <p-inputNumber name="montantExclu"   [inputStyle]="{'font-weight': 'bold'}" formControlName="montantExclu"  mode="decimal" locale="fr-FR" placeholder="montant exclu" (onBlur)="calculExclu()"></p-inputNumber>
                                  </div>
                               </div>
                               
                               
                               <div class="p-fluid p-formgrid p-grid">
                               
                                <div class="p-field p-col">
                                    <label for="nombreActe">Debours <span class="required">*</span></label>
                                    <p-inputNumber [inputStyle]="{'font-weight': 'bold'}" formControlName="debours" [disabled]="true" mode="decimal" locale="fr-FR" class="champ"></p-inputNumber>  
                                </div>

                                <div class="p-field p-col">
                                    <label for="nombreActe">Base remboursement<span class="required">*</span></label>
                                    <p-inputNumber [inputStyle]="{'font-weight': 'bold'}" formControlName="baseRemboursement" [disabled]="true" mode="decimal" locale="fr-FR" class="champ"></p-inputNumber>  
                                </div>
                                   
                                <div class="p-field p-col">
                                    <label for="sousActe">Taux <span class="required">*</span></label>
                                    <p-dropdown inputId="taux" dataKey="id" [filter]="true"
                                                showClear="true" [options]="tauxList"
                                                formControlName="taux"
                                                optionLabel="taux" [disabled]="true" [autoDisplayFirst]="false"></p-dropdown>
                                </div>
                                
                               </div>
                               
                               
                               
                               <div class="p-fluid p-formgrid p-grid">
                                   
                                
                                   
                                <div class="p-field p-col">
                                    <label for="nombreActe">Montant remboursé<span class="required">*</span></label>
                                    <p-inputNumber  [inputStyle]="{'font-weight': 'bold'}"formControlName="montantRembourse" mode="decimal" locale="fr-FR" [disabled]="true" class="champ"></p-inputNumber>  
                                </div>
                                <div class="p-field p-col-4">
                                    <label for="nombreActe">Part de l'assuré(e)<span class="required">*</span></label>
                                    <p-inputNumber formControlName="montantSupporte" mode="decimal" locale="fr-FR" [disabled]="true"></p-inputNumber>  
                                </div>
                                
                                
                                <div class="p-field p-col-4">
                                    <label for="sousActe">Decision <span class="required">*</span></label>
                                    <p-dropdown inputId="decision" [filter]="true"
                                                showClear="true" [options]="typeSort"
                                                formControlName="sort"
                                                 [disabled]="true" [autoDisplayFirst]="false"></p-dropdown>
                                </div>
                                   
                               </div>
        
                               
                               <div class="p-fluid p-formgrid p-grid">

                                
                                <div class="p-field p-col-4">
                                    <label>Montant plafond sous-acte</label>
                                    <p-inputNumber formControlName="montantPlafond" mode="decimal" locale="fr-FR" [disabled]="true"></p-inputNumber>   
                                </div>
                                <div class="p-field p-col">
                                <label for="observation">Observation <span class="required">*</span></label>
                                <textarea pInputTextarea formControlName="observation" autoResize="autoResize"></textarea>
                                </div>
                               </div>
                        
                            <br/>
                            <div class="p-grid p-justify-between">
                                <div>
                                 
                                    <button pButton pRipple label="Quitter" icon="pi pi-check" type="button" class="p-button-success p-mr-2 p-mb-2" (click)="fermerPrestation()"></button>
                                </div>
                                <div>
                                    <button  pButton  pRipple  label="Ajouter"[disabled]="!adherentSelected || prestationPopForm.invalid || displayFP"  icon="pi pi-check" type="submit" class="p-button-success p-mr-2 p-mb-2" ></button>
                                </div>
                            </div>

                    </form>
                </div>
            </ng-template>
           
     </p-dialog>

     <p-dialog header="Ajouter des observations au(x) produit(s) non pris en charge" styleClass="p-datatable-striped" [position]="position" [modal]="true" [style]="{width: '50vw'}" [baseZIndex]="10000"
     [draggable]="false" [resizable]="false" [(visible)]="displayProduitExclus">
     <div class="card">
        <!-- <h5>Cell Editing</h5> -->
        <p-table [value]="produitPharmaceutiqueListExclu" dataKey="id">
            <ng-template pTemplate="header">
                <tr>
                    <th>Produits</th>
                    <th>Observation</th>
                    <th>Montant</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
                <tr>
                    <!-- <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="product.libelle" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{product.libelle}}
                            </ng-template>
                        </p-cellEditor>
                    </td> -->
                    <td>{{product.libelle}}</td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText [(ngModel)]="product.observation">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{product.observation}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="number" [(ngModel)]="product.prix">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{product.prix}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
            <ng-template pTemplate="footer">
                <p-button icon="pi pi-check" (click)="addProduitExcluToSaveList()" label="Ok" styleClass="p-button-text"></p-button>
            </ng-template>
    </p-dialog>

        <p-dialog [maximizable]="true" #dialStudent (onShow)="showDialogPlafondMaximized(dialStudent)" [(visible)]="displayFormPrefinancement" header="Prefinancement" [modal]="true" styleClass="p-fluid" (onHide)="closeDialog()">
            <ng-template pTemplate="content">
                <div class="card">
                <form (ngSubmit)="onCreate()"  [formGroup]="prestationForm">    
                <p-fieldset legend="Sinistre" toggleable="true">
                        
                <div class="p-fluid p-formgrid p-grid">

                    <div class="p-field p-col">
                        <label for="dateEffet">Date de saisie <span class="required">*</span></label>
                        <p-calendar id="dateSaisie" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" formControlName="dateSaisie" appendTo="body"></p-calendar>
                    </div>
                    
                    <div class="p-field p-col">
                        <label for="dateEffet">Date de declaration <span class="required">*</span></label>
                        <input type="date" name="dateDeclaration" id="dateDeclaration" pInputText formControlName="dateDeclaration" (change)="checkDateCondition()">
                    </div>
                    <div class="p-field p-col">
                        <label for="typePaiement">Type de paiement <span class="required">*</span></label>
                        <p-dropdown inputId="typePaiement" [filter]="true"
                                                showClear="true" [options]="typePaiement2"
                                                formControlName="typePaiement"
                                                 [autoDisplayFirst]="false" (onChange)="changeType(prestationForm.value.typePaiement)"></p-dropdown>
                    </div>
                 
                </div>
                <div class="p-fluid p-formgrid p-grid">
                    <div class="required" *ngIf="prestationForm.value.typePaiement === 'ORANGE_MONEY'" class="p-field p-col">
                        <label for="dateEffet">Numero Orange Money<span class="required">*</span></label>
                        <input type="tel" name="numeroOrange" id="numeroOrange" pInputText formControlName="numeroOrange" (blur)="changeType(prestationForm.value.typePaiement)">
                    </div>
                    <div class="required" *ngIf="prestationForm.value.typePaiement === 'MOOV_MONEY'" class="p-field p-col">
                        <label for="dateEffet">Numero Moov Money <span class="required">*</span></label>
                        <input type="text" name="numeroMobicash" id="numeroMobicash" pInputText formControlName="numeroMobicash" (blur)="changeType(prestationForm.value.typePaiement)">
                    </div>
                    <div class="required" *ngIf="prestationForm.value.typePaiement === 'MOOV_MONEY' || prestationForm.value.typePaiement === 'ORANGE_MONEY'" class="p-field p-col">
                        <label for="dateEffet">Nom et prenom du bénéficiaire <span class="required">*</span></label>
                        <input type="text" name="nomBenefiniciaire" id="nomBenefiniciaire" pInputText formControlName="nomBenefiniciaire" (blur)="changeType(prestationForm.value.typePaiement)">
                    </div>
                    <div class="required" *ngIf="prestationForm.value.typePaiement === 'VIREMENT'" class="p-field p-col">
                        <label for="dateEffet">Numero Virement <span class="required">*</span></label>
                        <input type="text" name="numeroVirement" id="numeroVirement" pInputText formControlName="numeroVirement" (blur)="changeType(prestationForm.value.typePaiement)">
                    </div>
                </div>
                
                    
                                   
                    <div class="p-field p-col-2"></div>
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col-2">
                            <button pButton pRipple icon="pi pi-plus" pTooltip="Ajouter prestation" [disabled]="!this.prestationForm.get('dateDeclaration').value || !this.prestationForm.get('typePaiement').value || this.typePaiementValide === true" 
                            label="Ajouter prestation"
                                    class="p-button-success" type="button" (click)="addItemPrestation()"></button>
                    </div>
                    <div class="p-field p-col-2">
                        <button pButton [disabled]="!this.prestationForm.get('dateDeclaration').value || !this.prestationForm.get('typePaiement').value || this.typePaiementValide === true"
                                pRipple icon="pi pi-plus" pTooltip="Attacher bon" label="Attacher bon"
                                class="p-button-success" type="button" (click)="addBon()"></button>
                    </div>
                </div>
                </p-fieldset>
                
                <hr/>  
                        
              
                    <p-fieldset legend="Liste des Prestations" toggleable="true">
                        <!-- <div *ngIf="prestationsList.length >5" >
                            <button  pButton pRipple label="Mettre à jour le tableau" type="button"  icon="pi pi-refresh" (click)="updateView()" class="p-button-secondary  p-mr-2"></button>
                        </div> -->
                            <p-table #dt [value]="prestationsList" dataKey="id" editMode="row"  [globalFilterFields]="['sinistreTierPayant.numeroSinistre','adherent.nom','familleActe.libelle', 
                            'acte.libelle','sousActe.libelle','adherent.prenom','baseRemboursement','taux.taux','montantRembourse']" [columns]="cols" 
                            [rowHover]="true"  styleClass="p-datatable-customers"
                            currentPageReportTemplate="affichage {first} à {last} de {totalRecords} enregistrement" [rows]="5" [paginator]="true" [showCurrentPageReport]="true">
    
                                <ng-template pTemplate="caption">
                                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                                        <h5 class="p-m-0"></h5>
                                        <span class="p-input-icon-left">
                                        <i class="pi pi-search"></i>
                                        <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." />
                                        </span>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="header">
                                    <tr>
                                    
                                       
                                       <!--  <th style="width:8rem">N° Sinistre</th> -->
                                        <th>Date de soins</th>
                                        <th>Assuré</th>
                                        <th>Famille acte</th>
                                        <th>Acte</th>
                                        <th>Sous Acte</th>
                                        <th>Base de  remboursement</th>
                                        <th>Taux</th>
                                        <th>Montant remboursé</th>
                                        <th style="width:8rem"></th>
                                        
                                    </tr>
                                </ng-template>
                    
                                <ng-template  pTemplate="body" let-rowData let-ri="rowIndex" >
                                    <tr>
                                
                                       <!--  <td  style="width:8rem">{{rowData?.sinistreTierPayant?.numeroSinistre}}</td> -->
                                        <td>{{rowData.dateSoins | formatTableValue : 'date'}}</td>
                                        <td>{{rowData.adherent?.nom}}&nbsp;&nbsp;{{rowData.adherent?.prenom}}</td>
                                        <td>{{rowData.familleActe?.libelle}}</td>
                                        <td>{{rowData.acte?.libelle}}</td>
                    
                                        <td> {{rowData.sousActe?.libelle}}</td>
                                        <td style="font-weight: bold"> {{rowData.baseRemboursement  | formatTableValue: 'number':true}}</td>
                                        <td style="font-weight: bold"> {{rowData.taux?.taux}}</td>
                                        <td style="font-weight: bold"> {{rowData.montantRembourse  | formatTableValue: 'number':true}}</td>
                                        
                                        <td style="text-align:center">
                                            <button  pButton pRipple type="button" pTooltip="editer la prestation"  icon="pi pi-pencil" (click)="editerPrestation1(rowData, ri)" class="p-button-rounded p-button-success p-mr-2"></button>
                                            <button pButton pRipple type="button" pTooltip="supprimer la prestation"   icon="pi pi-trash" class="p-button-danger p-mb-2" (click)="supprimerPrestation(rowData,ri)"></button>

                    
                                            </td>
                                
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-fieldset>
                        
                        <br/>
                        <div class="p-grid p-justify-between">
                            <div>
                                <button pButton pRipple label="Quitter" icon="pi pi-check" class="p-button-success p-mr-2 p-mb-2" ></button>
                            </div>
                            <div>
                                <button  pButton [disabled]="!prestationsList.length" pRipple  label="Valider" icon="pi pi-check" type="submit" class="p-button-success p-mr-2 p-mb-2" ></button>
                            </div>
                        </div>
               </form>
               </div>    
               </ng-template>      
            </p-dialog>

            <p-dialog [(visible)]="showMessage" header="Plafond presque atteint" [modal]="true" styleClass="p-fluid" 
                 [style]="{width: '1000px'}">

                <ng-template pTemplate="content">
                    <div class="card primeeee">

                    <span class="prime">{{montantReponse.message}} </span><br>


                    </div>
                </ng-template>
            </p-dialog>

            
<p-confirmDialog [style]="{width: '450px'}" acceptLabel="Oui" rejectLabel="Non"></p-confirmDialog>
</div>
</div>
