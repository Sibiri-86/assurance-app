<div class="p-grid">
    <div class="p-col-12">
        <p-toast></p-toast>
        <div class="card">
            <p-toolbar styleClass="p-mb-4">
                <ng-template pTemplate="left">
                    <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success p-mr-2 p-mb-2" (click)="addPolice()"></button>
                    <button pButton pRipple label="Supprimer" icon="pi pi-trash" class="p-button-danger p-mb-2" (click)="deleteSelectedPolice()" [disabled]="!selectedGarants || !selectedGarants.length"></button>
                </ng-template>
            </p-toolbar>

            <p-table #dt [value]="policeList" [columns]="cols" [rows]="10" [paginator]="true" [globalFilterFields]="['garant.nom','intermediaire.nom','numero','taux.taux']"
                     [rowHover]="true" dataKey="id"
                     styleClass="p-datatable-customers"
                     currentPageReportTemplate="affichage {first} à {last} de {totalRecords} enregistrement" [showCurrentPageReport]="true">
                <ng-template pTemplate="caption">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                        <h5 class="p-m-0"></h5>
                        <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." />
                        </span>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="numero" style="width: 12rem">Numero<p-sortIcon field="numero"></p-sortIcon></th>
                        <th pSortableColumn="nom" style="width: 12rem">Souscripteur<p-sortIcon field="nom"></p-sortIcon></th>
                        <th pSortableColumn="taux" style="width: 5rem">Taux <p-sortIcon field="taux.taux"></p-sortIcon></th>
                        <th pSortableColumn="territorialite" style="width: 14rem">Territorialite <p-sortIcon field="territorialite.libelle"></p-sortIcon></th>
                        <th pSortableColumn="duree" style="width: 6rem">Duree <p-sortIcon field="duree"></p-sortIcon></th>
                        <th pSortableColumn="dateEffet" style="width: 12rem">Date effet <p-sortIcon field="dateEffet"></p-sortIcon></th>
                        <th pSortableColumn="dateEcheance" style="width: 12rem">Date écheance <p-sortIcon field="dateEcheance"></p-sortIcon></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-police>
                    <tr>
                        <td>
                            <p-tableCheckbox [value]="police"></p-tableCheckbox>
                        </td>

                        <td><span class="p-column-title">{{police.numero}}</span>
                        </td>
                        <td><span class="p-column-title">{{police.nom}}</span>
                        </td>
                        <td><span class="p-column-title">{{police.taux.taux}}</span>
                        </td>
                        <td>
                            <span class="p-column-title" *ngFor="let t of police.territorialite">
                                {{t.libelle}}
                            </span>
                        </td>
                        <td><span class="p-column-title">{{police.duree}}</span>
                        </td>
                        <td><span class="p-column-title">{{police.dateEffet | formatTableValue : 'date'}}</span>
                        </td>
                        <td>
                            <span class="p-column-title">{{police.dateEcheance | formatTableValue : 'date'}}</span>
                        </td>
                        <td>
                            <button pButton pRipple icon="pi pi-pencil" pTooltip="editer" class="p-button-rounded p-button-success p-mr-2" (click)="editPolice(police)"></button>
                            <button pButton pRipple icon="pi pi-trash" pTooltip="Supprimer" class="p-button-rounded p-button-warning p-mr-2" (click)="deletePolice(police)"></button>
                            <button pButton  pRipple icon="pi pi-eye" pTooltip="voir groupe" class="p-button-rounded p-button-info p-mr-2" (click)="voirGroupe(police)"></button>
                            <button pButton  pRipple icon="pi pi-search" pTooltip="voir details" class="p-button-rounded p-button-help p-mr-2" (click)="onRowSelectPolice(police)"></button>
                            <button pButton  [disabled]="!police.listGroupe ||!police.listGroupe.length" icon="pi pi-check" pTooltip="Valider" class="p-button-rounded p-button-info p-mr-2" (click)="validerPolice(police)"></button>
                            <button pButton  [disabled]="!police.listGroupe ||!police.listGroupe.length" pRipple icon="pi pi-print" pTooltip="Imprimer" class="p-button-rounded p-button-info" (click)="imprimer(police)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="summary">
                    <div class="p-d-flex p-ai-center p-jc-between">
                        {{policeList ? policeList.length : 0 }} police(s).
                    </div>
                </ng-template>
            </p-table>


        </div>

        <p-dialog [(visible)]="displaySousActe" header="Sous-acte" [modal]="true" styleClass="p-fluid" [style]="{width: '1200px'}">
            <div class="card">
                <p-toolbar styleClass="p-mb-4">
                    <ng-template pTemplate="left">
                        <button pButton pRipple label="Valider" icon="pi pi-check" (click)="addSousActe()" class="p-button-success p-mr-2 p-mb-2" ></button>
                    </ng-template>
                </p-toolbar>

                <h5></h5>
                <p-table #dtSousActe [value]="plafondSousActe" dataKey="" editMode="row">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Sous acte</th>
                            <th>Prime</th>
                            <th>Periode</th>
                            <th>Nombre acte</th>
                            <th>Taux</th>
                            <th>Date effet</th>
                            <th style="width:8em"></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                        <tr [pEditableRow]="rowData">
                            <td>
                                {{rowData.sousActe.libelle}}
                            </td>

                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" [(ngModel)]="rowData.montantPlafond" required>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.montantPlafond}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="rowData.dimensionPeriode" optionLabel="libelle" placeholder="Select Make"
                                                    [style]="{'width':'100%'}"></p-dropdown>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.dimensionPeriode?.libelle}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" [(ngModel)]="rowData.nombre" required>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.nombre}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-dropdown [options]="tauxList" [(ngModel)]="rowData.taux" optionLabel="taux" placeholder="Select Make"
                                                    [style]="{'width':'100%'}"></p-dropdown>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.taux.taux}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-calendar  [showIcon]="true" [(ngModel)]="rowData.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.dateEffet | formatTableValue : 'date'}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td style="text-align:center">
                                <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitPlafondSousActe(rowData)"></button>
                                <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSavePlafondSousActe(rowData)"></button>
                                <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancelPlafondSousActe(rowData, ri)"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-dialog>



        <p-dialog [maximizable]="true" [(visible)]="displayPrevisualiserParametrage" header="Récapitulatif" [modal]="true" styleClass="p-fluid" [style]="{'width':'1500px'}">
            <ng-template pTemplate="content">
                <div class="p-formgroup-inline">
                    <div class="p-field">
                    <button [disabled]="!plafondFamilleActeConstruct || !plafondFamilleActeConstruct.length" pButton pRipple type="button" (click)="validerRecap()" label="Valider"></button>
                    </div>
                    <div class="p-field">
                    <button pButton pRipple type="button" (click)="viderRecap()" label="Reinitialiser"></button>
                    </div>
                </div>
                <p-table [value]="plafondFamilleActeConstruct" responsiveLayout="scroll" dataKey="garantie.id" [scrollable]="true" scrollHeight="500px">
                    <ng-template pTemplate="header">
                        <tr>
                            <th></th>
                            <th>Famille acte</th>
                            <th>Montant plafonné /acte</th>
                            <th>Montant plafonné /periode</th>
                            <th>Periode</th>
                            <th>Nombre acte</th>
                            <th>Taux de couverture</th>
                            <th>Domaine</th>
                            <th>Date effet</th>
                            <th>Status</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-plafond let-expanded="expanded" >
                        <tr class="colorZone">
                            <td>
                                <button type="button" pButton pRipple [pRowToggler]="plafond" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                            </td>
                            <td>{{plafond.garantie.libelle}}</td>
                            <td></td>
                            <td>{{plafond.montantPlafond}}</td>
                            <td>{{plafond?.dimensionPeriode?.libelle}}</td>
                            <td>{{plafond.nombre}}</td>
                            <td>{{plafond?.taux?.taux}}</td>
                            <td ><span *ngFor="let d of plafond.domaine">{{d.libelle}}</span></td>
                            <td>{{plafond.dateEffet | formatTableValue : 'date'}}</td>
                            <td >{{plafond.etat}}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-plafond>
                        <tr>
                            <td colspan="10">
                                <div class="">
                                    <p-table [value]="plafond.listeActe" dataKey="id" [scrollable]="true" scrollHeight="500px">
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                        <ng-template pTemplate="body" let-acte let-expanded="expanded">
                            <tr class="colorZoneActe">
                                <td> <button type="button" pButton pRipple [pRowToggler]="acte" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button></td>
                                <td>{{acte?.acte?.libelle}}</td>
                                <td></td>
                            <td>{{acte?.montantPlafond}}</td>
                            <td>{{acte?.dimensionPeriode?.libelle}}</td>
                            <td>{{acte?.nombre}}</td>
                            <td>{{acte?.taux?.taux}}</td>
                            <td ></td>
                            <td>{{acte?.dateEffet | formatTableValue : 'date'}}</td>
                            <td >{{acte?.etat}}</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="rowexpansion" let-acte>
                            <tr>
                            <td colspan="10">
                                <div class="">
                                <p-table [value]="acte.listeSousActe" dataKey="id" [scrollable]="true" scrollHeight="400px">
                            <tr>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                            <ng-template pTemplate="body" let-sousActe let-expanded="expanded">
                                <tr class="colorZoneSousActe">
                                    <td></td>
                                    <td>{{sousActe?.sousActe?.libelle}}</td>
                                    <td>{{sousActe?.montantPlafondParActe}}</td>
                                    <td>{{sousActe?.montantPlafond}}</td>
                                    <td>{{sousActe?.dimensionPeriode?.libelle}}</td>
                                    <td>{{sousActe?.nombre}}</td>
                                    <td>{{sousActe?.taux?.taux}}</td>
                                    <td ></td>
                                    <td>{{sousActe?.dateEffet | formatTableValue : 'date'}}</td>
                                    <td >{{sousActe?.etat}}</td>
                                </tr>
                            </ng-template>
                </p-table>        
    </div>
    </td>
    </tr>
    </ng-template>
    </p-table>
</div>
</td>
</tr>
</ng-template>
</p-table>
</ng-template>
</p-dialog>




<p-dialog [maximizable]="true" [(visible)]="displayConfigurationPlafond" header="Configuration actuelle" [modal]="true" styleClass="p-fluid" [style]="{'width':'1500px'}">
    <ng-template pTemplate="content">
        <div class="p-col-12">
           
                <div class="p-formgroup-inline">
                    <div class="p-field">
                        <label for="taux" class="p-sr-only">Taux</label>
                        <p-dropdown dataKey="id" inputId="taux" [filter]="true" showClear="true" [options]="tauxList" placeholder="Select taux" optionLabel="taux" [(ngModel)]="taux"></p-dropdown>
                    </div>
                    <div class="p-field">
                        <label for="typeBareme" class="p-sr-only">TypeBareme</label>
                        <p-dropdown dataKey="id" inputId="typeBareme" [filter]="true" showClear="true" [options]="typeBareme" placeholder="Select type-barème" [(ngModel)]="bareme"></p-dropdown>
                    </div>
                    
                    <div class="p-field">
                    <button pButton [disabled]="!taux || !bareme" pRipple type="button" label="Importer barème standard" (click)="importerBareme()"></button>
                    </div>
                </div>
        
            <br/>
            <br/>
            
        
            <p-table #dtConfigurationPlafond [value]="plafondActuelleConfiguration" dataKey="garantie.id" dataKey="id" editMode="row" responsiveLayout="scroll" [scrollable]="true" scrollHeight="500px">
                <ng-template pTemplate="header">
                    <tr>
                        <th></th>
                        <th>Famille acte</th>
                        <th>Montant plafonné / acte</th>
                        <th>Montant plafonné / periode</th>
                        <th>Periode</th>
                        <th>Nombre acte</th>
                        <th>Taux de couverture</th>
                        <th>Domaine</th>
                        <th>Date effet</th>
                        <th>Status</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-plafond let-editing="editing" let-ri1="rowIndex" let-expanded="expanded" >
                    <tr [pEditableRow]="plafond" class="colorZone">
                        <td>
                            <button type="button" pButton pRipple [pRowToggler]="plafond" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                        </td>
                        <td>{{plafond.garantie.libelle}}</td>
                        <!--
                        <td>{{plafond.montantPlafond}}</td>
                        -->
                        <td>   
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="plafond.montantPlafond" [value]="plafond.montantPlafond | formatTableValue: 'number':true" placeholder="plafond/periode" required>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{plafond.montantPlafond}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="plafond.dimensionPeriode" optionLabel="libelle" placeholder="Select periode"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{plafond?.dimensionPeriode?.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="plafond.nombre">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{plafond.nombre}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="tauxList" [(ngModel)]="plafond.taux" optionLabel="taux" placeholder="Select taux"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{plafond?.taux?.taux}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-multiSelect [options]="qualiteAssureList"  [(ngModel)]="plafond.domaine" optionLabel="libelle"
                                                   [style]="{'width':'100%'}" placeholder="Select domaine"></p-multiSelect>
                                </ng-template>
                                <ng-template pTemplate="output">
                                        <span *ngFor="let d of plafond.domaine">
                                            {{d.libelle}}
                                        </span>
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-calendar  [showIcon]="true" [(ngModel)]="plafond.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{plafond.dateEffet | formatTableValue : 'date'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeEtat" [(ngModel)]="plafond.etat" placeholder="Select status"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output" *ngIf="plafond.etat">
                                    {{plafond?.etat}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
    
                        <td style="text-align:center">
                            <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitPlafondConfiguration(plafond)"></button>
                            <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSavePlafondConfiguration(plafond)"></button>
                            <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancelPlafondConfiguration(plafond, ri1)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="rowexpansion" let-plafond let-ri1>
                    <tr >
                    <td colspan="11">
                        <div class="">
                            <p-table [value]="plafond.listeActe" dataKey="acte.id" editMode="row" [scrollable]="true" scrollHeight="400px">
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                    <ng-template pTemplate="body" let-acte let-editing="editing" let-ri="rowIndex" let-expanded="expanded">
                        <tr  [pEditableRow]="acte" class="colorZoneActe">
    
                            <td> <button type="button" pButton pRipple [pRowToggler]="acte" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button></td>
                            <td>{{acte?.acte?.libelle}}</td>
                            <td>   
                            </td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" [(ngModel)]="acte.montantPlafond" [value]="acte.montantPlafond | formatTableValue: 'number':true" placeholder="plafond/periode" required>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{acte.montantPlafond}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
    
                           
    
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="acte.dimensionPeriode" optionLabel="libelle" placeholder="Select periode"
                                                    [style]="{'width':'100%'}"></p-dropdown>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{acte?.dimensionPeriode?.libelle}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
    
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" [(ngModel)]="acte.nombre">
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{acte.nombre}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
        
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-dropdown [options]="tauxList" [(ngModel)]="acte.taux" optionLabel="taux" placeholder="Select taux"
                                                    [style]="{'width':'100%'}"></p-dropdown>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{acte?.taux.taux}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
    
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-multiSelect [options]="qualiteAssureList"  [(ngModel)]="acte.domaine" optionLabel="libelle" placeholder="Select domaine"
                                                       [style]="{'width':'100%'}"></p-multiSelect>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                            <span *ngFor="let d of acte.domaine">
                                                {{d.libelle}}
                                            </span>
                                    </ng-template>
                                </p-cellEditor>
                            </td>
    
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-calendar  [showIcon]="true" [(ngModel)]="acte.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{acte.dateEffet | formatTableValue : 'date'}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
    
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-dropdown [options]="typeEtat" [(ngModel)]="acte.etat" placeholder="Select Make"
                                                    [style]="{'width':'100%'}"></p-dropdown>
                                    </ng-template>
                                    <ng-template pTemplate="output" *ngIf="acte.etat">
                                        {{acte?.etat}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
    
                            <td style="text-align:center">
                                <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitPlafondConfigurationActe(acte)"></button>
                                <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSavePlafondConfigurationActe(acte)"></button>
                                <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancelPlafondConfigurationActe(acte, ri, ri1)"></button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-acte>
                        <tr>
                            <td colspan="11">
                                <div class="">
                                    <p-table [value]="acte.listeSousActe" dataKey="id" editMode="row" [scrollable]="true" scrollHeight="500px">
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                        <ng-template pTemplate="body" let-sousActe let-editing="editing" let-ri="rowIndex" let-expanded="expanded">
                            <tr [pEditableRow]="sousActe" class="colorZoneSousActe">
                                <td></td>
                                <td>{{sousActe?.sousActe?.libelle}}</td>
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText type="text" [(ngModel)]="sousActe.montantPlafondParActe" [value]="sousActe.montantPlafondParActe | formatTableValue: 'number':true" placeholder="plafond/periode" required>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{sousActe.montantPlafond}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText type="text" [(ngModel)]="sousActe.montantPlafond" [value]="sousActe.montantPlafond | formatTableValue: 'number':true" placeholder="plafond/acte" required>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{sousActe?.montantPlafond}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>        
    
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="sousActe.dimensionPeriode" optionLabel="libelle" placeholder="Select periode"
                                                        [style]="{'width':'100%'}"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{sousActe?.dimensionPeriode?.libelle}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
    
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText type="text" [(ngModel)]="sousActe.nombre">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{sousActe.nombre}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
            
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="tauxList" [(ngModel)]="sousActe.taux" optionLabel="taux" placeholder="Select taux"
                                                        [style]="{'width':'100%'}"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{sousActe?.taux.taux}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
    
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-multiSelect [options]="qualiteAssureList"  [(ngModel)]="sousActe.domaine" optionLabel="libelle"
                                                           [style]="{'width':'100%'}" placeholder="Select domaine"></p-multiSelect>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                                <span *ngFor="let d of sousActe.domaine">
                                                    {{d.libelle}}
                                                </span>
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
    
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-calendar  [showIcon]="true" [(ngModel)]="sousActe.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{sousActe.dateEffet | formatTableValue : 'date'}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
    
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="typeEtat" [(ngModel)]="sousActe.etat" placeholder="Select status"
                                                        [style]="{'width':'100%'}"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output" *ngIf="sousActe.etat">
                                            {{sousActe?.etat}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
    
                                <td style="text-align:center">
                                    <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitPlafondConfigurationSousActe(sousActe)"></button>
                                    <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSavePlafondConfigurationSousActe(sousActe)"></button>
                                    <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancelPlafondConfigurationSousActe(sousActe, ri, ri1)"></button>
                                </td>
                            </tr>
                        </ng-template>
    
                       
            </p-table>
    </div>
    </td>
    </tr>
    </ng-template>
    </p-table>
    </div>
    </td>
    </tr>
    </ng-template>
    </p-table>
<br/>
<br/>
<div class="p-grid p-justify-between">
    <div>
        <button pButton pRipple label="Quitter" icon="pi pi-times" (click)="fermerConfigurationPlafond()"></button>
    </div>

    <div>
        <!--<button [disabled]="primeForm?.invalid || groupeForm?.invalid" pButton pRipple label="Suivant" icon="pi pi-angle-right" (click)="nextToAdherent()"></button>-->
        <button pButton pRipple label="Appliquer" icon="pi pi-pencil" (click)="appliquerConfiguration()"></button>
    </div>
</div>
</div>
</ng-template>
</p-dialog>






<p-dialog [maximizable]="true" [(visible)]="displayParametragePlafond" header="Parametrage plafond" [modal]="true" styleClass="p-fluid" (onHide)=" this.groupeForm.reset()" [style]="{width: '1500px'}">
    <div class="card">
        <p-fieldset legend="Plafond" toggleable="true">
            <form [formGroup]="plafondForm">

                <div class="p-fluid p-formgrid p-grid">
                    <!--
                    <div class="p-field p-col-4">
                        <label for="domaine">Domaine d'application</label>
                        <div>
                        <span *ngFor="let qualite of qualiteAssureList">
                        <p-radioButton [id]="qualite.id" name="domaine" [value]="qualite" formControlName="domaine" class="p-mr-2"></p-radioButton>
                        <span class="p-mr-2">{{qualite.libelle}}</span>
                        </span>
                        </div>
                    </div>
                    -->
                    <div class="p-field p-col">
                        <label for="primeFamille">Plafond global annuelle par personne</label>
                        <input id="primeFamille" type="text" pInputText formControlName="plafondAnnuellePersonne" [value]="plafondForm.get('plafondAnnuellePersonne').value | formatTableValue: 'number':true"  (blur) ='saisiePrimePersonne()'>
                    </div>

                    <div class="p-field p-col">
                        <label for="montantPrimeEnfant">Plafond global par famille</label>
                        <input id="montantPrimeEnfant" type="text" pInputText formControlName="plafondAnnuelleFamille" [value]="plafondForm.get('plafondAnnuelleFamille').value | formatTableValue: 'number':true" (blur) ='saisiePrimeFamille()'>
                    </div>

                    <div class="p-field p-col" *ngIf="isInternationalGroupe">
                        <label for="montantPrimeEnfant">Plafond global internationnal</label>
                        <input id="montantPrimeEnfant" type="text" pInputText formControlName="plafondGlobalInternationnal" [value]="plafondForm.get('plafondGlobalInternationnal').value | formatTableValue: 'number':true" >
                    </div>
                </div>
            </form>
        </p-fieldset>
        <br/>

        <p-fieldset legend="Barème" toggleable="true">
            <p-toolbar>
                <div class="p-toolbar-group-left">
                </div>
                <div class="p-toolbar-group-right">
                    <button pButton pRipple label="Configuration" icon="pi pi-eye"  class="p-button-success p-mr-2 p-mb-2" (click)="voirConfiguration()"></button>
                    <button *ngIf="reponse==1" pButton pRipple [disabled]="!plafondFamilleActeConstruct || !plafondFamilleActeConstruct.length"   label="Récapitulatif" icon="pi pi-eye" class="p-button-success p-mr-2 p-mb-2" (click)="voirParametrage()"></button>
                </div>
            </p-toolbar>
            <br/>
            
            
            <div class="p-field p-col">
                <label for="montantPrimeEnfant">Voulez vous configurer manuellement les barèmes?</label>
            </div>
            <div class="p-field-radiobutton">
                <p-radioButton name="reponse" value="1" [(ngModel)]="reponse" inputId="rep1" (onClick)="onClickReponse($event)"></p-radioButton>
                <label for="oui">Oui</label>
            </div>
            <div class="p-field-radiobutton">
                <p-radioButton name="reponse" value="0" [(ngModel)]="reponse" inputId="rep2" (onClick)="onClickReponse($event)"></p-radioButton>
                <label for="non">Non</label>
            </div>

           <div *ngIf="reponse==1">
            <p-table #dt [value]="plafondFamilleActe" dataKey="" editMode="row" >
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width:3em"></th>
                        <th>Famille acte</th>
                        <th>Montant plafonné/acte</th>
                        <th>Montant plafonné/periode</th>
                        <th>Periode</th>
                        <th>Nombre acte</th>
                        <th>Taux de couverture</th>
                        <th>Domaine</th>
                        <th>Date effet</th>
                        <th>Status</th>
                        <th></th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                    <tr [pEditableRow]="rowData" class="colorZone">
                        <td style="width:3em"></td>
                        
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="garanties" [(ngModel)]="rowData.garantie" optionLabel="libelle" placeholder="Select Make"
                                                [style]="{'width':'100%'}" (onChange)="changeGarantie($event, ri)"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output" *ngIf="rowData.garantie">
                                    {{rowData?.garantie.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        
                        <td>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.montantPlafond" [value]="rowData.montantPlafond | formatTableValue: 'number':true" placeholder="plafond/periode">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.montantPlafond}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="rowData.dimensionPeriode" optionLabel="libelle" placeholder="Select Periode"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.dimensionPeriode?.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.nombre" placeholder="nombre acte">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.nombre}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>

                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="tauxList"  [(ngModel)]="rowData.taux" optionLabel="taux"
                                                [style]="{'width':'100%'}" placeholder="Select taux"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output" >
                                        <span *ngIf="rowData.garantie.libelle">
                                            {{rowData?.taux?.taux}}
                                        </span>
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-multiSelect [options]="qualiteAssureList"  [(ngModel)]="rowData.domaine" optionLabel="libelle"
                                                   [style]="{'width':'100%'}" placeholder="select domaine"></p-multiSelect>
                                </ng-template>
                                <ng-template pTemplate="output">
                                        <span *ngFor="let d of rowData.domaine">
                                            {{d.libelle}}
                                        </span>
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td >
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-calendar [showIcon]="true" [(ngModel)]="rowData.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body" placeholder="date effet"></p-calendar>
                                </ng-template>
                                <ng-template  pTemplate="output">
                                    <span *ngIf="rowData.garantie.libelle">
                                        {{rowData.dateEffet | formatTableValue : 'date'}}
                                    </span>
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeEtat" [(ngModel)]="rowData.etat" placeholder="Select status"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.etat}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td style="text-align:center">
                            <button *ngIf="!editing" pButton pRipple  pTooltip="editer" pInitEditableRow icon="pi pi-pencil" class="ui-button-info p-mr-2" (click)="onRowEditInit(rowData)"></button>
                            <button *ngIf="editing" pRipple  pButton  pSaveEditableRow icon="pi pi-check" class="ui-button-success p-mr-2" style="margin-right: .5em" (click)="onRowEditSave(rowData, ri)"></button>
                            <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger p-mr-2" (click)="onRowEditCancel(rowData, ri)"></button>
                            <button *ngIf="!editing && rowData.garantie.libelle " pRipple pButton  pCancelEditableRow icon="pi pi-arrow-circle-down"  pTooltip="enregistrer" class="ui-button-danger p-mr-2" (click)="addFamilleActe(rowData, ri)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <p-table #dtActe [value]="plafondActe" dataKey="id" editMode="row" *ngIf="displayActe" [scrollable]="true" scrollHeight="400px"  >
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width:3em"></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-expanded="expanded" let-editing="editing" let-ri="rowIndex">
                    <tr [pEditableRow]="rowData" class="colorZoneActe">
                        <td style="width:3em">
                            <button type="button" pButton pRipple [pRowToggler]="rowData" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                        </td>
                        <td >
                            {{rowData.acte.libelle}}
                        </td>
                        <td>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.montantPlafond" [value]="rowData.montantPlafond | formatTableValue: 'number':true" placeholder="plafond/periode">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.montantPlafond}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="rowData.dimensionPeriode" optionLabel="libelle" placeholder="Select periode"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.dimensionPeriode?.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.nombre" required placeholder="nombre acte">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.nombre}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="tauxList" [(ngModel)]="rowData.taux" optionLabel="taux" placeholder="Select taux"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.taux?.taux}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                        </td>
                        <td >
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-calendar  [showIcon]="true" [(ngModel)]="rowData.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body" placeholder="date effet"></p-calendar>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.dateEffet | formatTableValue : 'date'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeEtat" [(ngModel)]="rowData.etat" placeholder="Select status"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.etat}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td style="text-align:center">
                            <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info p-mr-2" (click)="onRowEditInitPlafondActe(rowData)"></button>
                            <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success p-mr-2" style="margin-right: .5em" (click)="onRowEditSavePlafondActe(rowData,ri)"></button>
                            <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger p-mr-2" (click)="onRowEditCancelPlafondActe(rowData, ri)"></button>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="rowexpansion" let-rowData>
                    <tr [pEditableRow]="rowData2">
                    <td colspan="11">
                    <div class="">
                    <p-table [value]="rowData.listeSousActe" dataKey="id" editMode="row" [scrollable]="true" scrollHeight="400px">

                    <ng-template pTemplate="header">
                        <tr>
                        <th style="width:3em"></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        </tr>
                   </ng-template>

                <ng-template pTemplate="body" let-rowData2 let-editing="editing" let-rit="ri">
                    
                    <tr [pEditableRow]="rowData2" class="colorZoneSousActe">
                        <td style="width:3em"></td>
                        <td>
                            {{rowData2?.sousActe.libelle}}
                        </td>
                        
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData2.montantPlafondParActe" [value]="rowData2.montantPlafondParActe | formatTableValue: 'number':true" required placeholder="plafond/acte">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2.montantPlafondParActe}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData2.montantPlafond" [value]="rowData2.montantPlafond | formatTableValue: 'number':true" required placeholder="plafond/periode">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2.montantPlafond}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                       

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="rowData2.dimensionPeriode" optionLabel="libelle" placeholder="Select periode"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2?.dimensionPeriode?.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData2.nombre" required placeholder="nombre acte">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2.nombre}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="tauxList" [(ngModel)]="rowData2.taux" optionLabel="taux" placeholder="Select taux"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2?.taux.taux}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        
                        <td>
                        </td>
                        
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-calendar  [showIcon]="true" [(ngModel)]="rowData2.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body" placeholder="date effet"></p-calendar>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2.dateEffet | formatTableValue : 'date'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeEtat" [(ngModel)]="rowData2.etat" placeholder="Select status"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData2?.etat}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        
                        <td style="text-align:center">
                            <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitPlafondSousActe(rowData2)"></button>
                            <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSavePlafondSousActe(rowData2, ri)"></button>
                            <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancelPlafondSousActe(rowData2, ri1)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="9">Aucune sous-acte disponible</td>
                    </tr>
                </ng-template>
            </p-table>
        
        </div>
    
    </td>
    </tr>
    </ng-template>
    </p-table>
    </div>
    </p-fieldset>
    <br/>
    <br/>
    <div class="p-grid p-justify-between">
        <div>
            <button pButton pRipple label="Quitter" icon="pi pi-check" (click)="quitterParametragePlafond()" class="p-button-success p-mr-2 p-mb-2" ></button>
        </div>
        <div>
            <button pButton pRipple [disabled]="!valideMontantPlafond || !plafondFamilleActeConstruct.length" label="Valider" icon="pi pi-check" (click)="validerPlafond()" class="p-button-success p-mr-2 p-mb-2" ></button>
        </div>
    </div>

    </div>
</p-dialog>

<p-dialog [maximizable]="true" (onHide)="this.groupeForm.reset()" [(visible)]="displayDialogFormAddGroupe" header="Groupe" [modal]="true" styleClass="p-fluid" [style]="{'width':'1300px'}">
    <ng-template pTemplate="content">

        <div class="">

            <div class="card">
                <div *ngIf="displayGroupForm">

                    <p-fieldset legend="Caracteristique" toggleable="true">
                        <form [formGroup]="groupeForm">
                            <h5></h5>
                            <div class= "p-fluid p-formgrid p-grid">

                                <div class="p-field p-col">
                                    <label for="nom">Libelle <span style="color: red !important;">*</span></label>
                                    <input id="nom" type="text" formControlName="libelle"  pInputText>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'nom'">
                                    </app-entity-validation>
                                </div>

                                <div class="p-field p-col">
                                    <label for="taux">Taux de couverture <span style="color: red !important;">*</span></label>
                                    <p-dropdown id="taux" dataKey="id" inputId="taux" [filter]="true" showClear="true" [options]="tauxList" formControlName="taux" placeholder="Select" optionLabel="taux"></p-dropdown>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'taux'">
                                    </app-entity-validation>
                                </div>

                                <div class="p-field p-col">
                                    <label for="territorialite">Territorialité <span style="color: red !important;">*</span></label>
                                    <p-multiSelect id="territorialite" dataKey="id" inputId="territorialite" [filter]="true" showClear="true" [options]="territorialiteList" formControlName="territorialite" placeholder="Select" optionLabel="libelle"></p-multiSelect>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'territorialite'">
                                    </app-entity-validation>
                                </div>
                            </div>

                            <div class="p-fluid p-formgrid p-grid">

                                <div class="p-field p-col">
                                    <label for="dateEffet">Date effet <span style="color: red !important;">*</span></label>
                                    <p-calendar id="dateEffet"   [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" formControlName="dateEffet" appendTo="body" (onSelect)="checkDateEffet()"></p-calendar>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'dateEffet'">
                                    </app-entity-validation>
                                </div>

                                <div class="p-field p-col">
                                    <label for="typeDuree">Type durée <span style="color: red !important;">*</span></label>
                                    <p-dropdown id="typeDuree" dataKey="id" inputId="typeDuree" [filter]="true" showClear="true" (ngModelChange)="changeTypeDureeGroupe($event)" [options]="typeDuree" formControlName="typeDuree" placeholder="Select"></p-dropdown>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="policeForm" [entityField]="'typeDuree'">
                                    </app-entity-validation>
                                </div>

                                <div class="p-field p-col">
                                    <label for="duree">Durée <span style="color: red !important;">*</span></label>
                                    <input id="duree" type="number" (input)="onRefreshDateEcheanceForGroupe($event.target.value)"  formControlName="duree" pInputText>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'duree'">
                                    </app-entity-validation>
                                </div>
                            </div>

                            <div class="p-fluid p-formgrid p-grid">
                                <div class="p-field p-col-4">
                                    <label for="dateEcheance">Date écheance</label>
                                    <p-calendar id="dateEcheance" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" formControlName="dateEcheance" appendTo="body"></p-calendar>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'dateEcheance'">
                                    </app-entity-validation>
                                </div>
                                <div class="p-field p-col-4">
                                    <label for="adresse">Adresse <span style="color: red !important;">*</span></label>
                                    <input id="adresse" type="text" formControlName="adresse"  pInputText>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'adresse'">
                                    </app-entity-validation>
                                </div>
                                <div class="p-field p-col-4">
                                    <label for="description">Description <span style="color: red !important;">*</span></label>
                                    <input id="description" type="text" formControlName="description"  pInputText>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'description'">
                                    </app-entity-validation>
                                </div>
                                <div class="p-field p-col-4">
                                    <label for="commune">Commune<span style="color: red !important;">*</span></label>
                                    <p-dropdown id="commune" dataKey="id" inputId="commune" [filter]="true" showClear="true" [options]="communeList" formControlName="commune" placeholder="Select" optionLabel="libelle"></p-dropdown>
                                    <app-entity-validation [entityValidations]="entityValidations"
                                                           [formGroup]="groupeForm" [entityField]="'commune'">
                                    </app-entity-validation>
                                </div>
                            </div>
                        </form>
                    </p-fieldset>
                    <br/>
                    <p-fieldset legend="Parametrage prime" toggleable="true">
                        <form [formGroup]="primeForm">
                            <h5></h5>
                            <div class= "p-fluid p-formgrid p-grid">

                                <!--<div class="p-field p-col-4" >
                                    <label for="primeFamille">Prime Annuelle</label>
                                    <input id="primeAnnuelle" type="text" pInputText formControlName="primeAnnuelle" [value]="primeForm.get('primeAnnuelle').value | formatTableValue: 'number':true">
                                </div>-->

                                <div class="p-field p-col-4">
                                    <label for="typePrime">Type de prime<span style="color: red !important;">*</span></label>
                                    <p-dropdown id="typePrime" dataKey="id" inputId="typePrime" [filter]="true" showClear="true" [options]="typePrimeList" formControlName="prime" optionLabel="libelle" placeholder="selectionnez" (onChange)="changePrime($event)"></p-dropdown>
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PF'">
                                    <label for="primeFamille1">Prime famille /an</label>
                                    <input id="primeFamille1" type="text" pInputText [value]="primeForm.get('primeFamille').value | formatTableValue: 'number':true" formControlName="primeFamille">
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PAE'">
                                    <label for="montantPrimeAdulte">Prime adulte /an</label>
                                    <input id="montantPrimeAdulte" type="text" pInputText formControlName="primeAdulte" [value]="primeForm.get('primeAdulte').value | formatTableValue: 'number':true" >
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code=='PAE'">
                                    <label for="montantPrimeEnfant">Prime enfant /an</label>
                                    <input id="montantPrimeEnfant" type="text" pInputText formControlName="primeEnfant" [value]="primeForm.get('primeEnfant').value | formatTableValue: 'number':true" >
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PP'">
                                    <label for="montantPrimePersonne">Prime personne /an</label>
                                    <input id="montantPrimePersonne" type="text" pInputText formControlName="primePersonne" [value]="primeForm.get('primePersonne').value | formatTableValue: 'number':true" >
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PE'">
                                    <label for="montantPrimeEmploye">Prime employe /an</label>
                                    <input id="montantPrimeEmploye" type="text" pInputText formControlName="primeEmploye" [value]="primeForm.get('primeEmploye').value | formatTableValue: 'number':true" >
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PECE'">
                                    <label for="montantPrimeConjoint">Prime conjoint /an</label>
                                    <input id="montantPrimeConjoint" type="text" pInputText formControlName="primeConjoint" [value]="primeForm.get('primeConjoint').value | formatTableValue: 'number':true" >
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PECE'">
                                    <label for="montantPrimeEnfant1">Prime enfant /an</label>
                                    <input id="montantPrimeEnfant1" type="text" pInputText formControlName="primeEnfant" [value]="primeForm.get('primeEnfant').value | formatTableValue: 'number':true" >
                                </div>

                                <div class="p-field p-col-4" *ngIf="selectedTypePrime.code =='PECE'">
                                    <label for="montantPrimeEmploye1">Prime employé /an</label>
                                    <input id="montantPrimeEmploye1" type="text" pInputText formControlName="primeEmploye" [value]="primeForm.get('primeEmploye').value | formatTableValue: 'number':true" >
                                </div>
                            </div>
                        </form>
                    </p-fieldset>
                    <br/>
                    <div class="p-grid p-justify-between">
                        <div>
                            <button pButton pRipple label="Quitter" icon="pi pi-times" (click)="annulerSaisie()"></button>
                        </div>
                        <div>
                            <button [disabled]="primeForm?.invalid || groupeForm?.invalid" pButton pRipple label="Suivant" icon="pi pi-angle-right" (click)="nextToAdherent()"></button>
                            <!--<button [disabled]="groupeForm?.invalid && primeForm?.invalid" pButton label="Suivant" icon="pi pi-angle-right" (click)="nextToAdherent()"></button>-->
                        </div>
                        
                    </div>
                </div>
                <br/>

                <div *ngIf="displayAdherentForm">

                    <p-fieldset legend="Information adhérent" toggleable="true">
                        <div class="p-field p-col-12">
                            <div class="p-field p-col-7">
                                <div class="p-field-checkbox">
                                    <label class="p-badge-success">Souhaitez vous importer les adhérents à travers un fichier excel ?</label>
                                    <div class="p-field-radiobutton p-ml-5 p-mt-2"><br>
                                        <p-radioButton name="city" value="OUI" [(ngModel)]="isImport" inputId="city1" id="city1"></p-radioButton>
                                        <label for="city1">OUI</label>
                                    </div>
                                    <div class="p-field-radiobutton p-ml-5 p-mt-2"><br>
                                        <p-radioButton name="city" value="NON" [(ngModel)]="isImport" inputId="city2" id="city2"></p-radioButton>
                                        <label for="city2">NON </label>
                                    </div>
                                </div>
                            </div>
                            <div class="p-field p-col-5" *ngIf="isImport === 'OUI'">
                                <app-upload-file (fileEvent)="getAdherentFiles($event)"></app-upload-file>
                            </div>
                            <div class="p-field p-col-2">
                                <button pButton pRipple icon="pi pi-upload" pTooltip="Exporter un model" type="button"
                                        class="p-button p-button-icon" label="export model" (click)="exportModel()">
                                </button>
                            </div>
                        </div>

                        <form [formGroup]="adherentForm" *ngIf="isImport === 'NON'">
                            <h5></h5>
                            <div class="p-fluid p-formgrid p-grid">
                                <div class="p-field p-col">
                                    <label for="nom">Nom <span style="color: red">*</span> </label>
                                    <input id="nom" type="text" required formControlName="nom"  pInputText>
                                </div>

                                <div class="p-field p-col">
                                    <label for="prenom">Prenom <span style="color: red">*</span> </label>
                                    <input id="prenom" type="text"  formControlName="prenom" pInputText>
                                </div>

                                <div class="p-field p-col">
                                    <label for="numeroTelephone">Telephone <span style="color: red">*</span> </label>
                                    <p-inputMask id="numeroTelephone" formControlName="numeroTelephone" mask="99 99 99 99"></p-inputMask>
                                </div>
                            </div>

                            <div class="p-fluid p-formgrid p-grid">
                                <div class="p-field p-col">
                                    <label for="adresseEmail">Adresse Email <span style="color: red">*</span> </label>
                                    <input id="adresseEmail" type="email"  formControlName="adresseEmail" pInputText>
                                </div>

                                <div class="p-field p-col">
                                    <label for="adresse">Adresse <span style="color: red">*</span> </label>
                                    <input id="adresse" type="text" formControlName="adresse" pInputText>
                                </div>

                                <div class="p-field p-col">
                                    <label for="referenceBancaire">Reference bancaire <span style="color: red">*</span> </label>
                                    <input id="referenceBancaire" type="text"  formControlName="referenceBancaire" pInputText>
                                </div>
                            </div>

                            <div class="p-fluid p-formgrid p-grid">

                                <div class="p-field p-col">
                                    <label for="dateNaissance">Date de naissance <span style="color: red">*</span> </label>
                                    <p-calendar id="dateNaissance" [showIcon]="true" formControlName="dateNaissance" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                </div>

                                <div class="p-field p-col">
                                    <label for="lieuNaissance">Lieu de naissance <span style="color: red">*</span> </label>
                                    <input id="lieuNaissance" type="text" formControlName="lieuNaissance" pInputText>
                                </div>

                                <div class="p-field p-col">
                                    <label for="dateEntree">Date entrée <span style="color: red">*</span> </label>
                                    <p-calendar id="dateEntree"  [showIcon]="true" formControlName="dateEntree" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                </div>
                            </div>

                            <div class="p-fluid p-formgrid p-grid">

                                <div class="p-field p-col">
                                    <label for="genre">Genre <span style="color: red">*</span> </label>
                                    <p-dropdown id="genre" inputId="genre" dataKey="id" [filter]="true" showClear="true" [options]="genreList" formControlName="genre" placeholder="Select" optionLabel="libelle"></p-dropdown>
                                </div>

                                <div class="p-field p-col">
                                    <label for="profession">Profession <span style="color: red">*</span> </label>
                                    <p-dropdown id="profession" inputId="profession" dataKey="id" [filter]="true" showClear="true" [options]="professionList" formControlName="profession" placeholder="Select" optionLabel="libelle"></p-dropdown>
                                </div>

                                <div class="p-field p-col">
                                    <label for="qualiteAssure">Qualite assuré <span style="color: red">*</span> </label>
                                    <p-dropdown id="qualiteAssure" inputId="qualiteAssure" dataKey="id" [filter]="true" showClear="true" [options]="qualitePrincipalList" formControlName="qualiteAssure" placeholder="Select" optionLabel="libelle"></p-dropdown>
                                </div>
                            </div>

                            <div class="p-fluid p-formgrid p-grid">

                                <div class="p-field p-col-4">
                                    <label for="matriculeGarant">Matricule Garant <span style="color: red">*</span> </label>
                                    <input id="matriculeGarant" type="text" formControlName="matriculeGarant" pInputText>
                                </div>
                                <div class="p-field p-col-4">
                                    <label for="matriculeSouscripteur">Matricule Souscripteur <span style="color: red">*</span> </label>
                                    <input id="matriculeSouscripteur" type="text" formControlName="matriculeSouscripteur" pInputText>
                                </div>
                            </div>
                        </form>
                    </p-fieldset>
                    <br/>
                    <div *ngIf="isImport === 'NON'">
                    <p-fieldset legend="Famille adhérent" toggleable="true">
                        <p-toolbar styleClass="p-mb-4">
                            <ng-template pTemplate="left">
                                <button pButton pRipple label="Ajouter" icon="pi pi-plus" pAddRow [table]="dtFamilleAdherentGroupe" [newRow]="newRowFamilleAdherent()" class="p-button-success p-mr-2 p-mb-2" ></button>
                            </ng-template>
                        </p-toolbar>


                        <p-table #dtFamilleAdherentGroupe [value]="adherentFamilleList" dataKey="" editMode="row">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Mle. Garant</th>
                                    <th>Nom</th>
                                    <th>Prenom</th>
                                    <th>Telephone</th>
                                    <th>Date de naissance</th>
                                    <th>Date entrée</th>
                                    <th>Genre</th>
                                    <th>Qualite assuré</th>
                                    <th style="width:13em"></th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr [pEditableRow]="rowData">
                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <input pInputText type="text" [(ngModel)]="rowData.matriculeGarant" required>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.matriculeGarant}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>
                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <input pInputText type="text" [(ngModel)]="rowData.nom" required>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.nom}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <input pInputText type="text" [(ngModel)]="rowData.prenom" required>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.prenom}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <!--<input pInputText type="number" [(ngModel)]="rowData.telephone" required>-->
                                                <p-inputMask [(ngModel)]="rowData.numeroTelephone" mask="99 99 99 99"></p-inputMask>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.numeroTelephone}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <p-calendar  [(ngModel)]="rowData.dateNaissance" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.dateNaissance | formatTableValue : 'date'}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <p-calendar  [(ngModel)]="rowData.dateEntree" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.dateEntree | formatTableValue : 'date'}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <p-dropdown [options]="genreList" [(ngModel)]="rowData.genre" optionLabel="libelle" placeholder="Select Make"
                                                            [style]="{'width':'100%'}"></p-dropdown>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.genre?.libelle}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <p-dropdown [options]="membreList" [(ngModel)]="rowData.qualiteAssure" optionLabel="libelle" placeholder="Select Make"
                                                            [style]="{'width':'100%'}"></p-dropdown>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                {{rowData?.qualiteAssure?.libelle}}
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>

                                    <td style="text-align:center">
                                        <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitAdherentFamille(rowData, ri)"></button>
                                        <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSaveAdherentFamille(rowData, ri)"></button>
                                        <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" style="margin-right: .5em" (click)="onRowEditCancelAdherentFamille(rowData, ri)"></button>
                                        <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-trash" class="ui-button-danger" (click)="deleteRow(rowData, ri)"></button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>

                    </p-fieldset>
                    </div>
                    <div *ngIf="afficheDetail">
                        <app-adherent-list [adherentFamilleList]="FamilyListToImport"></app-adherent-list>
                    </div>
                    <br/>
                    <br/>
                    <div class="p-grid p-justify-between">
                        <div>
                            <button pButton pRipple label="Quitter" icon="pi pi-times" (click)="annulerSaisie()"></button>
                        </div>

                        <div *ngIf="isImport === 'NON'">
                            <button [disabled]="adherentForm?.invalid && groupeForm?.invalid" pButton pRipple label="Enregistrer" icon="pi pi-check" (click)="enregistrerAdherent()"></button>
                        </div>

                        <div>
                            <button pButton pRipple label="Valider" icon="pi pi-check" (click)="onCreateGroupe()"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--
                      <div class="card">
                              <h5></h5>

                              <p-toolbar styleClass="p-mb-4">
                              <ng-template pTemplate="left">
                              <button pButton type="button" icon="pi pi-plus" class="p-button-text" [label]="'Ajouter'"
                                   pAddRow [table]="dt" [newRow]="newRow()"></button>
                              </ng-template>
                              </p-toolbar>


                              <p-toolbar styleClass="p-mb-4">
                                  <ng-template pTemplate="left">
                                      <button pButton pRipple label="Valider" icon="pi pi-plus" (click)="addSousActe()" class="p-button-success p-mr-2 p-mb-2" ></button>
                                      <button pButton pRipple label="Consulter" icon="pi pi-plus" (click)="addSousActe()" class="p-button-success p-mr-2 p-mb-2" ></button>
                                  </ng-template>
                              </p-toolbar>

                              <p-table #dt [value]="plafondFamilleActe" dataKey="" editMode="row">
                                  <ng-template pTemplate="header">
                                      <tr>
                                          <th>Famille acte</th>
                                          <th>Montant</th>
                                          <th>Periode</th>
                                          <th>Nombre acte</th>
                                          <th>Date effet</th>
                                          <th style="width:8em"></th>
                                      </tr>
                                  </ng-template>

                                  <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                      <tr [pEditableRow]="rowData">
                                          <td>
                                              <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <p-dropdown [options]="garanties" [(ngModel)]="rowData.garantie" optionLabel="libelle" placeholder="Select Make"
                                                    [style]="{'width':'100%'}" (onChange)="changeGarantie($event, ri)"></p-dropdown>
                                                </ng-template>
                                                <ng-template pTemplate="output" *ngIf="rowData.garantie">
                                                    {{rowData.garantie.libelle}}
                                                </ng-template>
                                            </p-cellEditor>
                                          </td>

                                          <td>
                                            <p-cellEditor>
                                              <ng-template pTemplate="input">
                                                  <input pInputText type="text" [(ngModel)]="rowData.montantPlafond" required>
                                              </ng-template>
                                              <ng-template pTemplate="output">
                                                  {{rowData.montantPlafond}}
                                              </ng-template>
                                          </p-cellEditor>
                                          </td>
                                          <td>
                                              <p-cellEditor>
                                                  <ng-template pTemplate="input">
                                                      <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="rowData.dimensionPeriode" optionLabel="libelle" placeholder="Select Make"
                                                      [style]="{'width':'100%'}"></p-dropdown>
                                                  </ng-template>
                                                  <ng-template pTemplate="output">
                                                      {{rowData.dimensionPeriode.libelle}}
                                                  </ng-template>
                                            </p-cellEditor>
                                          </td>
                                          <td>
                                              <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <input pInputText type="text" [(ngModel)]="rowData.nombre" required>
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{rowData.nombre}}
                                                </ng-template>
                                            </p-cellEditor>
                                          </td>
                                          <td>
                                              <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <p-calendar  [showIcon]="true" [(ngModel)]="rowData.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{rowData.dateEffet}}
                                                </ng-template>
                                            </p-cellEditor>
                                          </td>
                                            <td style="text-align:center">
                                              <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info p-mr-2" (click)="onRowEditInit(rowData)"></button>
                                              <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success p-mr-2" style="margin-right: .5em" (click)="onRowEditSave(rowData)"></button>
                                              <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger p-mr-2" (click)="onRowEditCancel(rowData, ri)"></button>
                                              <button *ngIf="!editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger p-mr-2" (click)="addFamilleActe(rowData, ri)"></button>
                                          </td>
                                      </tr>
                                  </ng-template>
                              </p-table>


                              <p-table #dtActe [value]="plafondActe" dataKey="" editMode="row">
                                  <ng-template pTemplate="header">
                                      <tr>
                                          <th></th>
                                          <th></th>
                                          <th></th>
                                          <th></th>
                                          <th></th>
                                          <th style="width:8em"></th>
                                      </tr>
                                  </ng-template>
                                  <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                      <tr [pEditableRow]="rowData">
                                          <td>
                                              {{rowData.acte.libelle}}
                                              </td>
                                          <td>
                                            <p-cellEditor>
                                              <ng-template pTemplate="input">
                                                  <input pInputText type="text" [(ngModel)]="rowData.montantPlafond" required>
                                              </ng-template>
                                              <ng-template pTemplate="output">
                                                  {{rowData.montantPlafond}}
                                              </ng-template>
                                          </p-cellEditor>
                                          </td>
                                          <td>
                                              <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <p-dropdown [options]="dimensionPeriodeList" [(ngModel)]="rowData.dimensionPeriode" optionLabel="libelle" placeholder="Select Make"
                                                    [style]="{'width':'100%'}"></p-dropdown>
                                                </ng-template>
                                                <ng-template pTemplate="output" *ngIf="rowData.dimensionPeriode">
                                                    {{rowData.dimensionPeriode.libelle}}
                                                </ng-template>
                                            </p-cellEditor>
                                          </td>
                                          <td>
                                              <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <input pInputText type="text" [(ngModel)]="rowData.nombre" required>
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{rowData.nombre}}
                                                </ng-template>
                                            </p-cellEditor>
                                          </td>
                                          <td>
                                              <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <p-calendar  [showIcon]="true" [(ngModel)]="rowData.dateEffet"  dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{rowData.dateEffet}}
                                                </ng-template>
                                            </p-cellEditor>
                                          </td>
                                            <td style="text-align:center">
                                              <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info p-mr-2" (click)="onRowEditInitPlafondActe(rowData)"></button>
                                              <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success p-mr-2" style="margin-right: .5em" (click)="onRowEditSavePlafondActe(rowData)"></button>
                                              <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger p-mr-2" (click)="onRowEditCancelPlafondActe(rowData, ri)"></button>
                                              <button *ngIf="!editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger p-mr-2" (click)="getSousActe(rowData, ri)"></button>
                                          </td>
                                      </tr>
                                  </ng-template>
                              </p-table>

                             </div>


                  <div class="card">
                              <h5>Parametrage du plafond acte</h5>
                              <p-toolbar styleClass="p-mb-4">
                              <ng-template pTemplate="left">
                              <button pButton type="button" icon="pi pi-plus" class="p-button-text" [label]="'Ajouter'"
                               pAddRow [table]="dtActe" [newRow]="newRowPlafondActe()"></button>
                              </ng-template>
                              </p-toolbar>
                          </div>
                  -->
        <br/>
    </ng-template>
</p-dialog>


<p-dialog  [maximizable]="true" [(visible)]="displayDialogFormGroupe" header="Groupe" [modal]="true" styleClass="p-fluid" [style]="{'width':'1100px'}">
    <ng-template pTemplate="content">
        <div class="">
            <div class="card">
                <p-toolbar styleClass="p-mb-4">
                    <ng-template pTemplate="left">
                        <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success p-mr-2 p-mb-2" (click)="addGroupe()"></button>
                        <button pButton pRipple label="Supprimer" icon="pi pi-trash" class="p-button-danger p-mb-2" (click)="deleteSelectedPolice()" [disabled]="!selectedGarants || !selectedGarants.length"></button>
                    </ng-template>

                    <ng-template pTemplate="right">
                        <span><span class="indicateur">{{rapport?.nombreAdherent}}</span> Adhérents-</span>
                        <span><span class="indicateur">{{rapport?.nombreConjoint}}</span> Conjoint(e)-</span>
                        <span><span class="indicateur">{{rapport?.nombreEnfant}}</span> Enfants-</span>
                        <span><span class="indicateur">{{rapport?.total}}</span> Effectif total</span>
                    </ng-template>

                </p-toolbar>
                <p-table #dt [value]="groupeList"  [columns]="cols" [rows]="10" [paginator]="true" [globalFilterFields]="['libelle','description','duree','territorialite.libelle']"
                         [rowHover]="true" dataKey="id"
                         styleClass="p-datatable-customers"
                         currentPageReportTemplate="{first} to {last} of {totalRecords} enregistrements" [showCurrentPageReport]="true">
                    <ng-template pTemplate="caption">
                        <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                            <h5 class="p-m-0"></h5>
                            <span class="p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." [style]="{width: '20%'}" />
                            </span>

                        </div>
                    </ng-template>

                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 3rem">
                                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                            </th>
                            <th pSortableColumn="numeroGroupe" style="width: 4rem">N° <p-sortIcon field="numero.groupe"></p-sortIcon></th>
                            <th pSortableColumn="nom">Libelle <p-sortIcon field="garant.nom"></p-sortIcon></th>
                            <th pSortableColumn="intermediaire" style="width: 12rem">Taux <p-sortIcon field="intermediaire.nom"></p-sortIcon></th>
                            <th pSortableColumn="numero">Duree<p-sortIcon field="numero"></p-sortIcon></th>
                            <th pSortableColumn="territorialite" style="width: 12rem">Territorialite <p-sortIcon field="territorialite.libelle"></p-sortIcon></th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-groupe>
                        <tr>
                            <td>
                                <p-tableCheckbox [value]="groupe"></p-tableCheckbox>
                            </td>
                            <td><span class="p-column-title">{{groupe.numeroGroupe}}</span>
                            <td><span class="p-column-title">{{groupe.libelle}}</span>

                            </td>
                            <td><span class="p-column-title">{{groupe.taux.taux}}</span>

                            </td>
                            <td><span class="p-column-title">{{groupe.duree}}</span>

                            </td>

                            <td>
                                <span class="p-column-title" *ngFor="let t of groupe.territorialite">{{t.libelle}} </span>
                            </td>

                            <td>
                                <button pButton pRipple icon="pi pi-pencil" pTooltip="editer" class="p-button-rounded p-button-success p-mr-2" (click)="editGroupe(groupe)"></button>
                                <button pButton pRipple icon="pi pi-trash" pTooltip="supprimer" class="p-button-rounded p-button-warning p-mr-2" (click)="deleteGroupe(police)"></button>
                                <button pButton  pRipple icon="pi pi-cog" pTooltip="configurer le plafond" class="p-button-rounded p-button-info p-mr-2" (click)="parametrerPlafond(groupe)"></button>
                                <button pButton  pRipple icon="pi pi-eye" pTooltip="voir adherent" class="p-button-rounded p-button-info p-mr-2" (click)="voirAdherent(groupe)"></button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="summary">
                        <div class="p-d-flex p-ai-center p-jc-between">
                            {{groupeList ? groupeList.length : 0 }} groupe(s).
                        </div>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </ng-template>
</p-dialog>


<!--<p-dialog  [maximizable]="true" [(visible)]="isPlafondEditing"  header="Groupe" [modal]="true" styleClass="p-fluid" [style]="{'width':'1100px'}">
    <app-plafond-component (plafandEvent)="createPlafond($event)"></app-plafond-component>
</p-dialog>-->

<!--<p-dialog  [maximizable]="true" [(visible)]="isgroupEditing"  header="Groupe" [modal]="true" styleClass="p-fluid" [style]="{'width':'1100px'}">
    <app-avenant-groupe (groupeEvent)="groupeAdd($event)" [obj]="obj"></app-avenant-groupe>
</p-dialog>-->

<p-dialog  [maximizable]="true"  header="Groupe" [modal]="true" styleClass="p-fluid" [style]="{'width':'1100px'}">
    <ng-template pTemplate="content">
        <div class="">
            <div class="card">
                <p-toolbar styleClass="p-mb-4">
                    <ng-template pTemplate="left">
                        <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success p-mr-2 p-mb-2" (click)="addGroupe()"></button>
                        <button pButton pRipple label="Supprimer" icon="pi pi-trash" class="p-button-danger p-mb-2" (click)="deleteSelectedPolice()" [disabled]="!selectedGarants || !selectedGarants.length"></button>
                    </ng-template>
                    <!--
                    <ng-template pTemplate="right">
                        <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Import" chooseLabel="Import" class="p-mr-2 p-mb-2 p-d-inline-block" ></p-fileUpload>
                        <button pButton pRipple label="Export" icon="pi pi-upload" class="p-button-help p-mb-2" (click)="dt.exportCSV()"></button>
                    </ng-template>
                    -->
                </p-toolbar>
                <p-table #dt [value]="adherentList"  [columns]="cols" [rows]="10" [paginator]="true" [globalFilterFields]="['libelle','description','duree','territorialite.libelle']"
                         [rowHover]="true" dataKey="id"
                         styleClass="p-datatable-customers"
                         currentPageReportTemplate="{first} to {last} of {totalRecords} enregistrements" [showCurrentPageReport]="true">
                    <ng-template pTemplate="caption">
                        <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                            <h5 class="p-m-0"></h5>
                            <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." [style]="{width: '20%'}" />
                        </span>
                        </div>
                    </ng-template>

                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 3rem">
                                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                            </th>
                            <th pSortableColumn="nom">Nom <p-sortIcon field="nom"></p-sortIcon></th>
                            <th pSortableColumn="prenom" style="width: 12rem">Prenom<p-sortIcon field="prenom"></p-sortIcon></th>
                            <th pSortableColumn="adresseEmail">Email<p-sortIcon field="adresseEmail"></p-sortIcon></th>
                            <th pSortableColumn="genre" style="width: 12rem">Genre<p-sortIcon field="genre.libelle"></p-sortIcon></th>
                            <th></th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-adherent>

                        <tr [ngClass]="{'colorZone': adherent.nom ==='test'}" *ngIf="adherent.nom ==='test'">
                            <td>
                                <p-tableCheckbox [value]="adherent"></p-tableCheckbox>
                            </td>
                            <td><span class="p-column-title">{{adherent.nom}}</span>

                            </td>
                            <td><span class="p-column-title">{{adherent.prenom}}</span>

                            </td>
                            <td><span class="p-column-title">{{adherent.email}}</span>

                            </td>
                            <td><span class="p-column-title">{{adherent.genre.libelle}}</span></td>
                            <td>
                                <button pButton pRipple icon="pi pi-pencil" pTooltip="editer" class="p-button-rounded p-button-success p-mr-2" (click)="editPolice(police)"></button>
                                <button pButton pRipple icon="pi pi-trash" pTooltip="supprimer" class="p-button-rounded p-button-warning p-mr-2" (click)="deletePolice(police)"></button>
                                <button pButton  pRipple icon="pi pi-cog" pTooltip="configurer le plafond" class="p-button-rounded p-button-info p-mr-2" (click)="parametrerPlafond(groupe)"></button>
                                <!--
                                <button pButton  pRipple icon="pi pi-eye" pTooltip="voir adherent" class="p-button-rounded p-button-info p-mr-2" (click)="voirAdherent()"></button>
                                -->
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="summary">
                        <div class="p-d-flex p-ai-center p-jc-between">
                            {{adherentList ? adherentList.length : 0 }} adherents au total.
                        </div>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </ng-template>
</p-dialog>



        <p-dialog [(visible)]="displayDialogFormUpdateAdherent" header="Modifier adherent" [modal]="true" styleClass="p-fluid" [style]="{'width':'1000px'}" (onHide)="adherentForm.reset()">
            <ng-template pTemplate="content">
                <p-fieldset legend="Adhérent" toggleable="true">
                    <div class="p-grid">
                        <div class="p-col-6">
                            <label for="a">Qualite assuré</label>
                            <p-dropdown  inputId="a" dataKey="id" [filter]="true" showClear="true"
                                         [options]="assurerListe" filterBy="nom, prenom, numero, groupe.nom"
                                         [(ngModel)]="adherantSelected" placeholder="Ex:" optionLabel="nom"></p-dropdown>
                        </div>
                        <div class="p-col-6"></div>
                    </div>
                    <form   [formGroup]="adherentForm">
                        <div class="card">
                        <div class="p-fluid p-formgrid p-grid">
                                <div class="p-field p-col">
                                <label for="firstname2">Nom</label>
                                <input id="nom" type="text" required formControlName="nom"  pInputText>
                                </div>

                                <div class="p-field p-col">
                                <label for="lastname2">Prenom</label>
                                <input id="lastname2" type="text"  formControlName="prenom" pInputText>
                                </div>

                                <div class="p-field p-col">
                                    <label for="lastname2">Telephone</label>
                                    <p-inputMask formControlName="numeroTelephone" mask="99 99 99 99"></p-inputMask>
                                </div>
                               </div>

                            <div class="p-fluid p-formgrid p-grid">
                            <div class="p-field p-col">
                            <label for="firstname2">Adresse email</label>
                            <input id="firstname2" type="text"  formControlName="adresseEmail" pInputText>
                            </div>

                            <div class="p-field p-col">
                            <label for="lastname2">Adresse</label>
                            <input id="lastname2" type="text" formControlName="adresse" pInputText>
                            </div>

                            <div class="p-field p-col">
                            <label for="lastname2">Reference bancaire</label>
                            <input id="lastname2" type="text"  formControlName="referenceBancaire" pInputText>
                            </div>
                        </div>

                        <div class="p-fluid p-formgrid p-grid">

                            <div class="p-field p-col">
                                <label for="lastname2">Date de naissance</label>
                                <p-calendar  [showIcon]="true" formControlName="dateNaissance" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                            </div>

                            <div class="p-field p-col">
                                <label for="lastname2">Lieu de naissance</label>
                                <input id="lastname2" type="text" formControlName="lieuNaissance" pInputText>
                            </div>

                            <div class="p-field p-col">
                                <label for="lastname2">Date entrée</label>
                                <p-calendar  [showIcon]="true" formControlName="dateEntree" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                            </div>
                        </div>

                        <div class="p-fluid p-formgrid p-grid">
                            <div class="p-field p-col">
                                <label for="lastname2">Genre</label>
                                <p-dropdown  inputId="genre" dataKey="id" [filter]="true" showClear="true" [options]="genreList" formControlName="genre" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            </div>

                            <div class="p-field p-col">
                                <label for="lastname2">Profession</label>
                                <p-dropdown  inputId="profession" dataKey="id" [filter]="true" showClear="true" [options]="professionList" formControlName="profession" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            </div>

                            <div class="p-field p-col-4">
                                <label for="lastname2">Qualite assuré</label>
                                <p-dropdown  inputId="qualiteAssure" dataKey="id" [filter]="true" showClear="true" [options]="qualitePrincipalList" formControlName="qualiteAssure" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            </div>
                        </div>

                        </div>
                       </form>
                    </p-fieldset>
            <br/>
            <div class="p-grid p-justify-between">
                <div>
                <button pButton pRipple label="Quitter" icon="pi pi-times" (click)="annulerSaisie()"></button>
                </div>
                <div>
                <button  [disabled]="adherentForm?.invalid" pButton pRipple label="Enregistrer" icon="pi pi-check" (click)="onCreateAddherent()"></button>
                </div>
            </div>
        </ng-template>
    </p-dialog>


<p-dialog [(visible)]="displayDialogFormAddAdherent" header="Ajouter un adherent" [modal]="true" styleClass="p-fluid" [style]="{'width':'1500px'}" (onHide)="adherentForm.reset()">
    <ng-template pTemplate="content">
        <p-fieldset legend="Adhérent" toggleable="true">
            <!--filtre des adhérents principaux-->
            <div class="p-field p-col">
                <label for="adherentSelected">Adhérent</label>
                <p-dropdown id="adherentSelected" inputId="adherentSelected" dataKey="id" [filter]="true" showClear="true" [options]="adherentPrincipaux" [(ngModel)]="adherentSelected"
                            (onChange)="loadAdherentPrincipalInfo()" placeholder="Recherchez un adhérent principal par son numéro, son nom et son prénom"
                            optionLabel="fullName"></p-dropdown>
            </div>
            <form (ngSubmit)="onCreateAddherent()"  [formGroup]="adherentForm">
                <div class="card">

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="matriculeGarant">Matricule Garant <span style="color: red !important;">*</span></label>
                            <input id="matriculeGarant" type="text"  formControlName="matriculeGarant" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'matriculeGarant'">
                            </app-entity-validation>
                        </div>
                        <div class="p-field p-col">
                            <label for="nom">Nom <span style="color: red !important;">*</span></label>
                            <input id="nom" type="text" required formControlName="nom"  pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'nom'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="prenom">Prenom <span style="color: red !important;">*</span></label>
                            <input id="prenom" type="text"  formControlName="prenom" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'prenom'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="matriculeSouscripteur">Matricule Souscripteur <span style="color: red">*</span> </label>
                            <input id="matriculeSouscripteur" type="text" formControlName="matriculeSouscripteur" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'matriculeSouscripteur'">
                            </app-entity-validation>
                        </div>
                        <div class="p-field p-col">
                            <label for="numeroTelephone">Telephone <span style="color: red !important;">*</span></label>
                            <input id="numeroTelephone" type="text" formControlName="numeroTelephone" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'numeroTelephone'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="adresseEmail">Adresse email <span style="color: red !important;">*</span></label>
                            <input id="adresseEmail" type="text"  formControlName="adresseEmail" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'adresseEmail'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col">
                            <label for="adresse">Adresse <span style="color: red !important;">*</span></label>
                            <input id="adresse" type="text" formControlName="adresse" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'adresse'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="dateNaissance">Date de naissance <span style="color: red !important;">*</span></label>
                            <p-calendar id="dateNaissance"  [showIcon]="true" formControlName="dateNaissance" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'dateNaissance'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lieuNaissance">Lieu de naissance <span style="color: red !important;">*</span></label>
                            <input id="lieuNaissance" type="text" formControlName="lieuNaissance" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'lieuNaissance'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        
                        <div class="p-field p-col">
                            <label for="dateEntree">Date entrée <span style="color: red !important;">*</span></label>
                            <p-calendar id="dateEntree"  [showIcon]="true" formControlName="dateEntree" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'dateEntree'">
                            </app-entity-validation>
                        </div>
                        <div class="p-field p-col">
                            <label for="genre">Genre <span style="color: red !important;">*</span></label>
                            <p-dropdown id="genre"  inputId="genre" dataKey="id" [filter]="true" showClear="true" [options]="genreList" formControlName="genre" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'genre'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="profession">Profession</label>
                            <p-dropdown id="profession"  inputId="profession" dataKey="id" [filter]="true" showClear="true" [options]="professionList" formControlName="profession" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'profession'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col-4">
                            <label for="qualiteAssure">Qualite assuré <span style="color: red !important;">*</span></label>
                            <p-dropdown id="qualiteAssure"  inputId="qualiteAssure" dataKey="id" [filter]="true" showClear="true" [options]="qualiteAssureList" formControlName="qualiteAssure" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'qualiteAssure'">
                            </app-entity-validation>
                        </div>
                        <div class="p-field p-col-4">
                            <label for="referenceBancaire">Reference bancaire</label>
                            <input id="referenceBancaire" type="text"  formControlName="referenceBancaire" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="adherentForm" [entityField]="'referenceBancaire'">
                            </app-entity-validation>
                        </div>
                       
                    </div>

                </div>
            </form>
        </p-fieldset>
        <p-fieldset legend="Membre" toggleable="true">
            <h5></h5>
            <p-toolbar styleClass="p-mb-4">
                <ng-template pTemplate="left">
                    <button pButton type="button" icon="pi pi-plus" class="p-button-text" [label]="'Ajouter'"
                            pAddRow [table]="dtFamilleAdherent" [newRow]="newRowFamilleAdherent()"></button>
                </ng-template>
            </p-toolbar>
            <p-table #dtFamilleAdherent [value]="adherentFamilleList" dataKey="" editMode="row">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Mle. Garant</th>
                        <th>Nom</th>
                        <th>Prenom</th>
                        <th>Telephone</th>
                        <th>Date de naissance</th>
                        <th>Date d'entrée</th>
                        <th>Genre</th>
                        <th>Qualite assuré</th>
                        <th style="width:8em"></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                    <tr [pEditableRow]="rowData">
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.matriculeGarant" required>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.matriculeGarant}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.nom" required>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.nom}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText type="text" [(ngModel)]="rowData.prenom" required>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.prenom}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-inputMask  [(ngModel)]="rowData.numeroTelephone" mask="99 99 99 99"></p-inputMask>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.numeroTelephone}}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-calendar  [(ngModel)]="rowData.dateNaissance" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData.dateNaissance | formatTableValue : 'date'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-calendar  [(ngModel)]="rowData.dateEntree" [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" appendTo="body"></p-calendar>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.dateEntree | formatTableValue : 'date'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="genreList" [(ngModel)]="rowData.genre" optionLabel="libelle" placeholder="Select Make"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.genre?.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="membreList" [(ngModel)]="rowData.qualiteAssure" optionLabel="libelle" placeholder="Select Make"
                                                [style]="{'width':'100%'}"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{rowData?.qualiteAssure?.libelle}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td style="text-align:center">
                            <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInitAdherentFamille(rowData, ri)"></button>
                            <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSaveAdherentFamille(rowData, ri)"></button>
                            <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancelAdherentFamille(rowData, ri)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-fieldset>
        <br/>
        <div class="p-grid p-justify-between">
            <div>
                <button pButton pRipple label="Quitter" icon="pi pi-times" (click)="annulerSaisie()"></button>
            </div>
            <div>
                <button pButton pRipple label="Enregistrer" icon="pi pi-check" (click)="onCreateAddherent()"></button>
            </div>
        </div>
    </ng-template>
</p-dialog>


            <p-dialog [maximizable]="true" [(visible)]="infosAdherent" header="Adherent détails" [modal]="true" styleClass="p-fluid" [style]="{width: '1000px'}">
                <ng-template pTemplate="content">
                    <div class="card">
                    <h5></h5>
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="lastname2">Matricule</label>
                            <div>
                                <span>{{adherent.numero}}</span>
                            </div>
                        </div>
                        <div class="p-field p-col">
                            <label for="lastname2">Matricule Garant</label>
                            <div>
                                <span>{{adherent.matriculeGarant}}</span>
                            </div>
                        </div>
                        <div class="p-field p-col">
                            <label for="lastname2">Matricule Souscripteur</label>
                            <div>
                                <span>{{adherent.matriculeSouscripteur}}</span>
                            </div>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="lastname2">Nom</label>
                            <div>
                                <span>{{adherent.nom}}</span>
                            </div>
                        </div>
                        <div class="p-field p-col">
                            <label for="lastname2">Prenom</label>
                            <div>
                                <span>{{adherent.prenom}}</span>
                            </div>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Lieu de naissance</label>
                            <div>
                                <span>{{adherent.lieuNaissance}}</span>
                            </div>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="lastname2">Date naissance</label>
                            <div>
                                <span>{{adherent.dateNaissance | formatTableValue: 'date'}}</span>
                            </div>
                        </div>
                        <div class="p-field p-col">
                            <label for="lastname2">Adresse</label>
                            <div>
                                <span>{{adherent.adresse}}</span>
                            </div>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Adresse-email </label>
                            <div>
                                <span>{{adherent.adresseEmail}}</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="lastname2">Genre</label>
                            <div>
                                <span>{{adherent?.genre?.libelle}}</span>
                            </div>
                        </div>
                        <div class="p-field p-col">
                            <label for="lastname2">Qualite-Assuré</label>
                            <div>
                                <span>{{adherent?.qualiteAssure?.libelle}}</span>
                            </div>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Profession</label>
                            <div>
                                <span>{{adherent?.profession?.libelle}}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-grid p-justify-center">
                    <div *ngIf="adherent.urlPhoto" class="">
                        <img [src]="adherent.urlPhoto" [alt]="adherent.nom" width="200" height="200" class="p-shadow-4" /> 
                    </div>
                   </div>
                    
                    
                </div>
                </ng-template>
            </p-dialog>
            
            
        <p-dialog [(visible)]="displayPhotos" header="Photos" [modal]="true" styleClass="p-fluid" [style]="{width: '300px'}">
            <ng-template pTemplate="content">
                <div class="card">
                <img [src]="pictureUrl" [alt]="" class="p-shadow-4" />
                </div>
            </ng-template>
        </p-dialog>

        <p-dialog   [maximizable]="true"    [(visible)]="displayDialogFormAdherent" header="Adherent et famille" [modal]="true" styleClass="p-fluid" [style]="{width: '1500px'}">
            <ng-template pTemplate="content">
                <div class="">
                <div class="card">
                <p-toolbar styleClass="p-mb-4">
                    <ng-template pTemplate="left">
                        <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success p-mr-2 p-mb-2" (click)="addAdherent(); loadAdherentPrincipalByGroupe(groupe)"></button>
                        <button pButton pRipple label="Supprimer" icon="pi pi-trash" class="p-button-danger p-mb-2 p-mr-2" (click)="deleteSelectedPolice()" [disabled]="!selectedGarants || !selectedGarants.length"></button>
                        <div class="p-mr-2 p-mb-2">
                            <p-fileUpload mode="basic" customUpload="true" chooseLabel="photos" uploadLabel="Valider" name="demo[]" accept="image/*" maxFileSize="1000000" (uploadHandler)="onBasicUpload($event)" ></p-fileUpload>
                        </div>
                    </ng-template>
                    <!--
                    <ng-template pTemplate="right">
                        <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Import" chooseLabel="Import" class="p-mr-2 p-mb-2 p-d-inline-block" ></p-fileUpload>
                        <button pButton pRipple label="Export" icon="pi pi-upload" class="p-button-help p-mb-2" (click)="dt.exportCSV()"></button>
                    </ng-template>
                    -->
                </p-toolbar>
                <p-table #dt [value]="adherentList"  [columns]="cols" [rows]="10" [paginator]="true" [globalFilterFields]="['libelle','description','duree','territorialite.libelle']"
                         [rowHover]="true" dataKey="id"
                         styleClass="p-datatable-customers"
                         currentPageReportTemplate="{first} to {last} of {totalRecords} enregistrements" (onRowSelect)="onRowSelect($event)" [showCurrentPageReport]="true">
                    <ng-template pTemplate="caption">
                        <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                            <h5 class="p-m-0"></h5>
                            <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." [style]="{width: '20%'}"/>
                    </span>
					</div>
				</ng-template>

				<ng-template pTemplate="header">
					<tr>
						<th style="width: 3rem">
							<p-tableHeaderCheckbox></p-tableHeaderCheckbox>
						</th>
                        <th pSortableColumn="numero" style="min-width:100px" >N°<p-sortIcon field="numero"></p-sortIcon></th>
                        <!--<th pSortableColumn="matricule" >Mle.<p-sortIcon field="matricule"></p-sortIcon></th>-->
                        <th pSortableColumn="matriculeGarant" style="min-width:200px" >Mle. Garant<p-sortIcon field="matriculeGarant"></p-sortIcon></th>
                        <th pSortableColumn="matriculeSouscripteur" style="min-width:200px" >Mle. Souscripteur<p-sortIcon field="matriculeSouscripteur"></p-sortIcon></th>
                        <th pSortableColumn="nom" style="min-width:200px" >Nom<p-sortIcon field="nom"></p-sortIcon></th>
                        <th pSortableColumn="prenom" style="min-width:200px" >Prenom <p-sortIcon field="prenom"></p-sortIcon></th>
                        <th pSortableColumn="numero" style="min-width:200px" >Date Naissance<p-sortIcon field="dateNaissance"></p-sortIcon></th>
                        <!--<th pSortableColumn="lieuNaissance" style="width: 12rem" >Lieu de naissance <p-sortIcon field="lieuNaissance"></p-sortIcon></th>-->
                        <th pSortableColumn="numeroTelephone" style="min-width:200px"  >Telephone <p-sortIcon field="numeroTelephone"></p-sortIcon></th>
                        <!--<th pSortableColumn="adresse" style="width: 10rem">Adresse<p-sortIcon field="adresse"></p-sortIcon></th>-->
						<th style="width:300px"></th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-adherent>
					<tr [ngClass]="{'colorZone': !adherent.adherentPrincipal}">
						<td><p-tableCheckbox [value]="adherent"></p-tableCheckbox></td>
						<td style="min-width:100px"><span class="p-column-title">{{adherent.numero}}</span></td>
						<td style="min-width:200px"><span class="p-column-title">{{adherent.matriculeGarant}}</span></td>
                        <td style="min-width:200px"><span class="p-column-title">{{adherent.matriculeSouscripteur}}</span></td>
						<!--<td><span class="p-column-title">{{adherent.groupe?.numero}}</span></td>-->
						<td style="min-width:200px"><span class="p-column-title">{{adherent.nom}}</span></td>
                        <td style="min-width:200px"><span class="p-column-title">{{adherent.prenom}}</span></td>
                        <td style="min-width:200px"><span class="p-column-title">{{adherent.dateNaissance | formatTableValue : 'date'}}</span></td>
                        <!--<td><span class="p-column-title">{{adherent.lieuNaissance}}</span></td>-->
                        <td style="min-width:200px"><span class="p-column-title">{{adherent.numeroTelephone}}</span></td>
                        <!--<td><span class="p-column-title">{{adherent.adresse}}</span></td>-->
						<td style="width:300px">
							<button pButton pRipple icon="pi pi-pencil" pTooltip="editer" class="p-button-rounded p-button-success p-mr-2" (click)="modifierAdherent(adherent)"></button>
							<button pButton pRipple icon="pi pi-trash" pTooltip="Supprimer" class="p-button-rounded p-button-warning p-mr-2" (click)="supprimerAdherent(adherent)"></button>
                            <button pButton pRipple icon="pi pi-eye" pTooltip="voir details" class="p-button-rounded p-button-warning p-mr-2" (click)="voirDetailAdherent(adherent)"></button>
                            <button *ngIf="adherent.urlPhoto" pButton pRipple icon="pi pi-search" pTooltip="voir photos" class="p-button-rounded p-button-warning" (click)="voirPhotos(adherent)"></button>
						</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="summary">
					<div class="p-d-flex p-ai-center p-jc-between">
						 {{adherentList ? adherentList.length : 0 }} assuré(s).
					</div>
				</ng-template>
			</p-table>
            </div>
            </div>
    </ng-template>
</p-dialog>




<p-dialog [maximizable]="true" [(visible)]="infosPolice" header="Police details" [modal]="true" styleClass="p-fluid" [style]="{width: '900px'}">
    <ng-template pTemplate="content">
        <div class="card">
            <h5></h5>
            <div class="p-fluid p-formgrid p-grid">
                <div class="p-field p-col">
                    <label for="lastname2">Garant</label>
                    <div>
                        <span>{{police.garant.nom}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Intermediaire</label>
                    <div>
                        <span>{{police.intermediaire.nom}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Taux de couverture</label>
                    <div>
                        <span>{{police.taux.taux}}</span>
                    </div>
                </div>
            </div>

            <div class="p-fluid p-formgrid p-grid">

                <div class="p-field p-col">
                    <label for="lastname2">Taux de commission en %</label>
                    <div>
                        <span>{{police.tauxCommissionIntermediaire?.taux}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="firstname2">Territorialité</label>
                    <div>
                        <span *ngFor="let t of police.territorialite">{{t.libelle}} </span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="dateEffet">Date effet</label>
                    <div>
                        <span>{{police.dateEffet}}</span>
                    </div>
                </div>

            </div>

            <div class="p-fluid p-formgrid p-grid">
                <div class="p-field p-col">
                    <label for="lastname2">Date echeance</label>
                    <div>
                        <span>{{police.dateEcheance}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="firstname2">Nom du souscripteur</label>
                    <div>
                        <span>{{police.nom}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Contact</label>
                    <div>
                        <span>{{police.contact}}</span>
                    </div>
                </div>
            </div>

            <div class="p-fluid p-formgrid p-grid">

                <div class="p-field p-col">
                    <label for="firstname2">Adresse email</label>
                    <div>
                        <span>{{police.adresseEmail}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="adressePostale">Adresse postale</label>
                    <div>
                        <span>{{police.adressePostale}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Secteur activite</label>
                    <div>
                        <span>{{police.secteurActivite.libelle}}</span>
                    </div>
                </div>
            </div>

            <div class="p-fluid p-formgrid p-grid">
                <div class="p-field p-col">
                    <label for="lastname2">Numero IFU</label>
                    <div>
                        <span>{{police.numeroIfu}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Personne ressource</label>
                    <div>
                        <span>{{police.personneRessource}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Contact personne ressource</label>
                    <div>
                        <span>{{police.contactPersonneRessource}}</span>
                    </div>
                </div>
            </div>

            <div class="p-fluid p-formgrid p-grid">
                <div class="p-field p-col">
                    <label for="refPolice">Reference police</label>
                    <div>
                        <span>{{police.referencePolice}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Rccm</label>
                    <div>
                        <span>{{police.rccm}}</span>
                    </div>
                </div>

                <div class="p-field p-col">
                    <label for="lastname2">Numero police</label>
                    <div>
                        <span>{{police.numero}}</span>
                    </div>
                </div>
            </div>

            <div class="p-fluid p-formgrid p-grid">

                <div class="p-field p-col">
                    <label for="lastname2">Secteur</label>
                    <div>
                        <span>{{police.secteur.libelle}}</span>
                    </div>
                </div>

                <div class="p-field p-col-4">
                    <label for="fraisAccessoire">Frais accessoire</label>
                    <div>
                        <span>{{police?.fraisAccessoire | formatTableValue: 'number':true}}</span>
                    </div>
                </div>
                <div class="p-field p-col-4">
                    <label for="fraisBadge">Frais badge</label>
                    <div>
                        <span>{{police?.fraisBadge | formatTableValue: 'number':true}}</span>
                    </div>
                </div>
            </div>

        </div>
    </ng-template>
</p-dialog>


<p-dialog [maximizable]="true" [(visible)]="displayDialogFormPolice" header="Police" [modal]="true" styleClass="p-fluid" [style]="{width: '1000px'}" (onHide)="policeForm.reset()">
    <ng-template pTemplate="content">
        <form (ngSubmit)="onCreate()"  [formGroup]="policeForm" >
            <div class="card">
                <p-fieldset legend="Identification" toggleable="true">
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="lastname2">Garant</label>
                            <p-dropdown dataKey="id" inputId="garant" [filter]="true" showClear="true" [options]="garantList" formControlName="garant" placeholder="Select" optionLabel="nom"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'garant'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Intermediaire</label>
                            <p-dropdown dataKey="id" inputId="intermediaire" [filter]="true" showClear="true" [options]="intermediaireList" formControlName="intermediaire" placeholder="Select" optionLabel="nom"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'intermediaire'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Taux de couverture</label>
                            <p-dropdown dataKey="id" inputId="taux" [filter]="true" showClear="true" [options]="tauxList" formControlName="taux" placeholder="Select" optionLabel="taux"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'taux'">
                            </app-entity-validation>
                        </div>
                    </div>

                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col">
                            <label for="lastname2">Taux de commission intermediaire en %</label>
                            <p-dropdown dataKey="id" inputId="taux commission intermediaire" [filter]="true" showClear="true" [options]="tauxCommissionIntermediaireList" formControlName="tauxCommissionIntermediaire" placeholder="Select" optionLabel="taux"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                          [formGroup]="policeForm" [entityField]="'taux'">
                        </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="firstname2">Territorialité</label>
                            <p-multiSelect dataKey="id" inputId="territorialite" [filter]="true" showClear="true" [options]="territorialiteList" formControlName="territorialite" placeholder="Select" optionLabel="libelle"></p-multiSelect>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'territorialite'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="dateEffet">Date effet</label>
                            <p-calendar  [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" formControlName="dateEffet" appendTo="body"></p-calendar>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'dateEffet'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col">
                            <label for="firstname2">Type durée</label>
                            <p-dropdown dataKey="id" inputId="typeDuree" [filter]="true" showClear="true" (ngModelChange)="changeTypeDuree()" [options]="typeDuree" formControlName="typeDuree" placeholder="Select"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'typeDuree'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Durée</label>
                            <input id="lastname2" type="number" (input)="onRefreshDateEcheance($event.target.value)"  formControlName="duree" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'duree'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col-4">
                            <label for="lastname2">Date echeance</label>
                            <p-calendar [showIcon]="true" dateFormat="dd/mm/yy" inputId="calendar" formControlName="dateEcheance" appendTo="body"></p-calendar>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'dateEcheance'">
                            </app-entity-validation>
                        </div>
                    </div>

                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col">
                            <label for="firstname2">Nom du souscripteur</label>
                            <input id="nom" type="text"  required formControlName="nom"  pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'nom'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Contact souscripteur</label>
                            <p-inputMask formControlName="contact" mask="99 99 99 99"></p-inputMask>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'contact'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="firstname2">Adresse email souscripteur</label>
                            <input id="adresseEmailSouscripteur" type="text" formControlName="adresseEmail" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'adresseEmail'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col">
                            <label for="adressePostale">Adresse postale souscripteur</label>
                            <input id="adressePostale" type="text" formControlName="adressePostale" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'adressePostale'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Secteur activité souscripteur</label>
                            <p-dropdown dataKey="id" inputId="secteurActivite" [filter]="true" showClear="true" [options]="secteurActiviteList" formControlName="secteurActivite" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'secteurActivite'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">IFU souscripteur</label>
                            <input id="ifu" type="text" formControlName="numeroIfu" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'numeroIfu'">
                            </app-entity-validation>
                        </div>


                    </div>

                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="lastname2">Personne ressource</label>
                            <input id="personneRess" type="text" formControlName="personneRessource" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'personneRessource'">
                            </app-entity-validation>
                        </div>
                        <div class="p-field p-col">
                            <label for="lastname2">Contact Personne ressource</label>
                            <p-inputMask formControlName="contactPersonneRessource" mask="99 99 99 99"></p-inputMask>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'contactPersonneRessource'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Email Personne ressource</label>
                            <input id="emailPers" type="email" formControlName="emailPersonneRessource" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'emailPersonneRessource'">
                            </app-entity-validation>
                        </div>

                    </div>

                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col-4">
                            <label for="refPolice">Reference police du garant</label>
                            <input id="referencePolice" type="text" formControlName="referencePolice" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'referencePolice'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col-4">
                            <label for="lastname2">RCCM souscripteur</label>
                            <input id="rccm" type="text" formControlName="rccm" pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'rccm'">
                            </app-entity-validation>
                        </div>
                    </div>
                </p-fieldset>
                <br/>
                <p-fieldset legend="Localisation" toggleable="true">
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col">
                            <label for="pays">Pays</label>
                            <p-dropdown inputId="pays" [filter]="true" dataKey="id" showClear="true" [options]="paysList" placeholder="Select" (onChange)="changeCountry($event)" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'pays'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Region</label>
                            <p-dropdown inputId="region" [filter]="true" showClear="true" dataKey="id" [options]="regionList" placeholder="Select" (onChange)="changeRegion($event)" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'region'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col">
                            <label for="lastname2">Province</label>
                            <p-dropdown inputId="departement" [filter]="true" showClear="true" dataKey="id" [options]="departementList"  (onChange)="changeDepartement($event)" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'departement'">
                            </app-entity-validation>
                        </div>
                    </div>


                    <div class="p-fluid p-formgrid p-grid">

                        <div class="p-field p-col-4">
                            <label for="lastname2">Commune <span class="required">*</span></label>
                            <p-dropdown inputId="commune" [filter]="true" showClear="true" [options]="communeList" formControlName="commune" dataKey="id" placeholder="Select" (onChange)="changeCommune($event)" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'commune'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col-4">
                            <label for="arrondissement">Arrondissement</label>
                            <p-dropdown inputId="arrondissement" [filter]="true" showClear="true" [options]="arrondissementList" dataKey="id" placeholder="Select" optionLabel="libelle" (onChange)="changeArrondissement($event)"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'arrondissement'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col-4">
                            <label for="secteur">Secteur <span class="required">*</span></label>
                            <p-dropdown inputId="secteur" [filter]="true" showClear="true" [options]="secteurList" dataKey="id" formControlName="secteur" placeholder="Select" optionLabel="libelle"></p-dropdown>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'secteur'">
                            </app-entity-validation>
                        </div>
                    </div>
                </p-fieldset>
                <br/>
                <p-fieldset legend="Frais" toggleable="true">
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col-4">
                            <label for="fraisAccessoire">Frais accessoire</label>
                            <input formControlName="fraisAccessoire" [value]="policeForm.get('fraisAccessoire').value | formatTableValue: 'number':true"  pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'fraisAccessoire'">
                            </app-entity-validation>
                        </div>

                        <div class="p-field p-col-4">
                            <label for="fraisBadge">Frais badge</label>
                            <input formControlName="fraisBadge" [value]="policeForm.get('fraisBadge').value | formatTableValue: 'number':true"  pInputText>
                            <app-entity-validation [entityValidations]="entityValidations"
                                                   [formGroup]="policeForm" [entityField]="'fraisBadge'">
                            </app-entity-validation>
                        </div>

                    </div>
                </p-fieldset>
            </div>

            <div class="p-grid p-justify-between">
                <div>
                    <button pButton pRipple type="button" label="Quitter" icon="pi pi-times" (click)="annulerSaisie()"></button>
                </div>
                <div>
                    <button *ngIf="!policeForm.get('id').value" [disabled]="policeForm?.invalid" pButton pRipple label="Enregistrer" icon="pi pi-check" type="submit"></button>
                    <button *ngIf="policeForm.get('id').value" [disabled]="policeForm?.invalid" pButton pRipple label="Modifier" icon="pi pi-check" type="submit"></button>
                </div>
            </div>
        </form>
    </ng-template>
</p-dialog>

<p-confirmDialog [style]="{width: '450px'}" acceptLabel="Oui" rejectLabel="Non"></p-confirmDialog>
</div>

</div>

